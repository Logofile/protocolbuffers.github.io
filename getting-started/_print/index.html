<!doctype html><html itemscope itemtype=http://schema.org/WebPage lang=en class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.107.0"><link rel=canonical type=text/html href=/getting-started/><link rel=alternate type=application/rss+xml href=/getting-started/index.xml><meta name=robots content="noindex, nofollow"><link rel="shortcut icon" href=/favicons/favicon.ico><link rel=apple-touch-icon href=/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/favicons/android-192x192.png sizes=192x192><title>Tutorials | Protocol Buffers Documentation</title><meta name=description content="Each tutorial in this section shows you how to implement a simple application using protocol buffers in your favourite language, introducing you to the language's protocol buffer API as well as showing you the basics of creating and using .proto files."><meta property="og:title" content="Tutorials"><meta property="og:description" content="Each tutorial in this section shows you how to implement a simple application using protocol buffers in your favourite language, introducing you to the language's protocol buffer API as well as showing you the basics of creating and using .proto files."><meta property="og:type" content="website"><meta property="og:url" content="/getting-started/"><meta property="og:site_name" content="Protocol Buffers Documentation"><meta itemprop=name content="Tutorials"><meta itemprop=description content="Each tutorial in this section shows you how to implement a simple application using protocol buffers in your favourite language, introducing you to the language's protocol buffer API as well as showing you the basics of creating and using .proto files."><meta name=twitter:card content="summary"><meta name=twitter:title content="Tutorials"><meta name=twitter:description content="Each tutorial in this section shows you how to implement a simple application using protocol buffers in your favourite language, introducing you to the language's protocol buffer API as well as showing you the basics of creating and using .proto files."><link rel=preload href=/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css as=style><link href=/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.6.0.min.js integrity=sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-5L8P8GRN4Y"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-5L8P8GRN4Y")}</script></head><body class=td-section><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/><span class="navbar-brand__logo navbar-logo"><svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 500 500" style="enable-background:new 0 0 500 500"><g><path style="fill:#fff" d="M116.8525 421.9722c-5.7041.0-10.3442-4.3127-10.3442-9.6129V88.183c0-5.3002 4.6401-9.6117 10.3442-9.6117H320.858c3.0347.0 9.3959.5498 11.7506 2.6302l.3545.3442 58.905 63.2912c2.3101 2.491 2.9202 8.4928 2.9202 11.3184v256.2039c0 5.3002-4.6407 9.6129-10.3436 9.6129H116.8525z"/><g><g><g><path style="fill:#767676" d="M384.4445 423.2066H116.852c-6.3839.0-11.5786-4.8658-11.5786-10.8474V88.1831c0-5.9804 5.1947-10.8461 11.5786-10.8461h204.0062c.377.0 9.2786.0329 12.568 2.9389l.3947.3833 58.9508 63.337c3.2135 3.4652 3.2514 11.7924 3.2514 12.1593v256.2036C396.0231 418.3408 390.8284 423.2066 384.4445 423.2066zM116.5079 411.9189c.0848.0278.1999.0531.3441.0531h267.5925c.1442.0.2581-.0253.3441-.0531V156.1556c-.0076-.9033-.3593-3.7347-.7034-5.0037l-57.6527-61.9416c-1.4651-.3176-4.4533-.6389-5.5742-.6389H116.852c-.143.0-.2594.024-.3441.0531V411.9189zm267.4533-261.149zM327.0321 89.371v.0013V89.371z"/></g></g></g><g><g><path style="fill:#5b7fc0" d="M189.0874 210.1754l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4473C177.5953 212.627 183.0601 210.1742 189.0874 210.1754zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 234.1722 197.0804 232.033z"/><path style="opacity:.3;fill:#fff" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/><g><defs><path id="SVGID_1_" d="M194.7376 237.6875c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 234.2399 196.1861 236.239 194.7376 237.6875z"/></defs><clipPath id="SVGID_2_"><use xlink:href="#SVGID_1_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_2_);fill:#fff" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/><path style="opacity:.13;clip-path:url(#SVGID_2_);fill:#020202" d="M190.0704 225.0237c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 225.7247 191.9774 225.0237 190.0704 225.0237z"/></g><g><defs><path id="SVGID_3_" d="M189.0898 210.176c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 212.6276 183.0612 210.176 189.0898 210.176zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 236.239 197.0839 234.2399 197.0839 232.0372z"/></defs><clipPath id="SVGID_4_"><use xlink:href="#SVGID_3_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_4_);fill:#5b7fc0" d="M172.6595 215.6045c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8475-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 209.1953 176.6171 211.647 172.6595 215.6045z"/></g></g><rect x="198.8952" y="225.1043" style="fill:#5b7fc0" width="122.6266" height="13.8671"/></g><g><path style="fill:#d95140" d="M189.0874 155.7611l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.0249 2.454-11.4897 6.4116-15.4473C177.5953 158.2128 183.0601 155.7599 189.0874 155.7611zm7.993 21.8577c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.2508 181.7667 197.0816 179.758 197.0804 177.6188z"/><path style="opacity:.3;fill:#fff" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/><g><defs><path id="SVGID_5_" d="M194.7376 183.2733c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 179.8256 196.1861 181.8248 194.7376 183.2733z"/></defs><clipPath id="SVGID_6_"><use xlink:href="#SVGID_5_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_6_);fill:#fff" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/><path style="opacity:.13;clip-path:url(#SVGID_6_);fill:#020202" d="M190.0704 170.6095c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9546.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.663-2.8588-6.116.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C193.7885 171.3104 191.9774 170.6095 190.0704 170.6095z"/></g><g><defs><path id="SVGID_7_" d="M189.0898 155.7617c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8066-21.8612-21.8613.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 158.2134 183.0612 155.7617 189.0898 155.7617zm7.9941 21.8613c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 181.8248 197.0839 179.8256 197.0839 177.623z"/></defs><clipPath id="SVGID_8_"><use xlink:href="#SVGID_7_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_8_);fill:#d95140" d="M172.6595 161.1903c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 154.7811 176.6171 157.2327 172.6595 161.1903z"/></g><rect x="198.8952" y="170.69" style="fill:#d95140" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#56a55c" d="M189.5379 264.6147l.0012-.0012c7.7751.0012 15.0294 4.1862 18.932 10.9235 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3304-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032-5.8394.0-11.3281-2.2733-15.458-6.4032-4.13-4.13-6.4032-9.6186-6.4056-15.4628.0012-6.0249 2.454-11.4897 6.4116-15.4472C178.0458 267.0663 183.5105 264.6135 189.5379 264.6147zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6538 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403C196.7013 290.6202 197.5321 288.6115 197.5309 286.4723z"/><path style="opacity:.3;fill:#fff" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/><g><defs><path id="SVGID_9_" d="M195.1881 292.1268c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.9989 7.9942-7.9941 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.5344 288.6792 196.6366 290.6783 195.1881 292.1268z"/></defs><clipPath id="SVGID_10_"><use xlink:href="#SVGID_9_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_10_);fill:#fff" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/><path style="opacity:.13;clip-path:url(#SVGID_10_);fill:#020202" d="M190.5209 279.463c-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7446-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9941 2.3802-1e-4 4.616 1.0833 6.1218 2.8788C194.239 280.164 192.4279 279.463 190.5209 279.463z"/></g><g><defs><path id="SVGID_11_" d="M189.5403 264.6153c7.7763.0 15.0283 4.1826 18.926 10.9151 1.9201 3.3135 2.9377 7.0987 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8613-12.0547.0024-21.8636-9.8065-21.8612-21.8613.0-6.0285 2.4516-11.492 6.4116-15.452C178.0482 267.0669 183.5117 264.6153 189.5403 264.6153zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9941.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.6366 290.6783 197.5344 288.6792 197.5344 286.4765z"/></defs><clipPath id="SVGID_12_"><use xlink:href="#SVGID_11_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_12_);fill:#56a55c" d="M173.11 270.0439c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8613 12.0547.0024 21.8636-9.797 21.8613-21.8613.0024-3.8474-1.0151-7.6326-2.9353-10.9462-3.8977-6.7325-11.1497-10.9151-18.926-10.9151C182.5311 263.6346 177.0676 266.0863 173.11 270.0439z"/></g></g><rect x="199.3456" y="279.5436" style="fill:#56a55c" width="122.6266" height="13.8671"/></g><g><g><path style="fill:#f1bc42" d="M189.0874 318.7208l.0012-.0012c7.7751.0012 15.0295 4.1862 18.932 10.9234 1.9177 3.3159 2.9305 7.1011 2.9293 10.9378.0 5.8394-2.2733 11.3305-6.4032 15.4604-4.1288 4.1288-9.6186 6.4032-15.458 6.4032s-11.328-2.2733-15.458-6.4032-6.4032-9.6186-6.4056-15.4628c.0012-6.025 2.454-11.4897 6.4116-15.4472C177.5953 321.1724 183.0601 318.7196 189.0874 318.7208zm7.993 21.8576c.0012-1.4042-.3687-2.7868-1.063-3.9887-1.4293-2.4684-4.0833-3.9995-6.9299-4.0019-4.4077.0024-7.993 3.5877-7.993 7.993.0 2.1356.832 4.1431 2.3427 5.6539 1.5083 1.5083 3.5159 2.3403 5.6503 2.3415 2.1356.0 4.1443-.8308 5.6539-2.3403S197.0816 342.7176 197.0804 340.5784z"/><path style="opacity:.3;fill:#fff" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/><g><defs><path id="SVGID_13_" d="M194.7376 346.2329c-1.4461 1.4461-3.4452 2.3439-5.6479 2.3439-4.4077-.0024-7.9918-3.5865-7.9942-7.9942.0024-4.4125 3.5937-7.999 7.9942-7.9942 2.8443.0 5.497 1.5323 6.924 3.9983.6991 1.2067 1.0702 2.5881 1.0702 3.9959C197.0839 342.7853 196.1861 344.7844 194.7376 346.2329z"/></defs><clipPath id="SVGID_14_"><use xlink:href="#SVGID_13_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_14_);fill:#fff" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/><path style="opacity:.13;clip-path:url(#SVGID_14_);fill:#020202" d="M190.0704 333.5691c-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0011 1.9547.7088 3.7452 1.8782 5.1354-1.7447-1.4674-2.8575-3.6631-2.8588-6.1161.0024-4.4125 3.5936-7.999 7.9942-7.9942 2.3802-1e-4 4.616 1.0834 6.1218 2.8788C193.7885 334.2701 191.9774 333.5691 190.0704 333.5691z"/></g><g><defs><path id="SVGID_15_" d="M189.0898 318.7214c7.7763.0 15.0283 4.1826 18.926 10.915 1.9201 3.3136 2.9377 7.0988 2.9353 10.9462.0024 12.0643-9.8065 21.8636-21.8613 21.8612-12.0547.0024-21.8636-9.8065-21.8612-21.8612.0-6.0285 2.4516-11.4921 6.4116-15.452C177.5977 321.173 183.0612 318.7214 189.0898 318.7214zm7.9941 21.8612c0-1.4078-.3711-2.7892-1.0702-3.9959-1.4269-2.466-4.0797-3.9983-6.924-3.9983-4.4005-.0048-7.9918 3.5817-7.9942 7.9942.0024 4.4077 3.5865 7.9918 7.9942 7.9942 2.2027.0 4.2018-.8978 5.6479-2.3439C196.1861 344.7844 197.0839 342.7853 197.0839 340.5826z"/></defs><clipPath id="SVGID_16_"><use xlink:href="#SVGID_15_" style="overflow:visible"/></clipPath><path style="clip-path:url(#SVGID_16_);fill:#f1bc42" d="M172.6595 324.15c-3.96 3.96-6.4116 9.4235-6.4116 15.452-.0024 12.0547 9.8066 21.8636 21.8613 21.8612 12.0547.0024 21.8636-9.797 21.8613-21.8612.0024-3.8474-1.0151-7.6327-2.9353-10.9462-3.8977-6.7324-11.1497-10.9151-18.926-10.9151C182.0806 317.7407 176.6171 320.1924 172.6595 324.15z"/></g></g><rect x="198.8952" y="333.6497" style="fill:#f1bc42" width="122.6266" height="13.8671"/></g></g></svg></span><span class=navbar-brand__name>Protocol Buffers Documentation</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"></ul></div><div class="navbar-nav d-none d-lg-block"><div class=td-search><div class=td-search__icon></div><input type=search class="td-search__input form-control td-search-input" placeholder="Search this site…" aria-label="Search this site…" autocomplete=off></div></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><main class="col-12 col-md-9 col-xl-8 pl-md-5" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>This is the multi-page printable view of this section.
<a href=# onclick="return print(),!1">Click here to print</a>.</p><p><a href=/getting-started/>Return to the regular view of this page</a>.</p></div><h1 class=title>Tutorials</h1><div class=lead>Each tutorial in this section shows you how to implement a simple application using protocol buffers in your favourite language, introducing you to the language&rsquo;s protocol buffer API as well as showing you the basics of creating and using .proto files.</div><ul><li>1: <a href=#pg-c7598e0887644bef72a2bb1cdeeb59e8>Protocol Buffer Basics: C++</a></li><li>2: <a href=#pg-c37cedc15574a7fcfc38b58898222d81>Protocol Buffer Basics: C#</a></li><li>3: <a href=#pg-57e77ec44bbffe514c16fdf04681bbd0>Protocol Buffer Basics: Dart</a></li><li>4: <a href=#pg-e100e6a28103bb1dde6c2b61e5119bab>Protocol Buffer Basics: Go</a></li><li>5: <a href=#pg-8d415712a04e782902fbfc8fb9406a26>Protocol Buffer Basics: Java</a></li><li>6: <a href=#pg-fa8ab8e34046dabb4113b881a4df3c09>Protocol Buffer Basics: Kotlin</a></li><li>7: <a href=#pg-dd7b75154d644d27da6f4367d70ffff7>Protocol Buffer Basics: Python</a></li></ul><div class=content><p>Each tutorial in this section shows you how to implement a simple application
using protocol buffers in your favourite language, introducing you to the
language&rsquo;s protocol buffer API as well as showing you the basics of creating and
using .proto files. The complete sample code for each application is also
provided.</p><p>The tutorials don&rsquo;t assume that you know anything about protocol buffers, but do
assume that you are comfortable writing code in your chosen language, including
using file I/O.</p><ul><li><a href=/getting-started/cpptutorial>C++</a></li><li><a href=/getting-started/csharptutorial>C#</a></li><li><a href=/getting-started/darttutorial>Dart</a></li><li><a href=/getting-started/gotutorial>Go</a></li><li><a href=/getting-started/javatutorial>Java</a></li><li><a href=/getting-started/kotlintutorial>Kotlin</a></li><li><a href=/getting-started/pythontutorial>Python</a></li></ul></div></div><div class=td-content style=page-break-before:always><h1 id=pg-c7598e0887644bef72a2bb1cdeeb59e8>1 - Protocol Buffer Basics: C++</h1><div class=lead>This tutorial provides a basic C++ programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic C++ programmers introduction to working with
protocol buffers. By walking through creating a simple example application, it
shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the C++ protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in C++. For more
detailed reference information, see the
<a href=/programming-guides/proto>Protocol Buffer Language Guide (proto2)</a>,
the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide (proto3)</a>,
the <a href=/reference/cpp/api-docs>C++ API Reference</a>, the
<a href=/reference/cpp/cpp-generated>C++ Generated Code Guide</a>,
and the
<a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>The raw in-memory data structures can be sent/saved in binary form. Over
time, this is a fragile approach, as the receiving/reading code must be
compiled with exactly the same memory layout, endianness, etc. Also, as
files accumulate data in the raw format and copies of software that are
wired for that format are spread around, it&rsquo;s very hard to extend the
format.</li><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Instead of these options, you can use protocol buffers. Protocol buffers are the
flexible, efficient, automated solution to solve exactly this problem. With
protocol buffers, you write a <code>.proto</code> description of the data structure you
wish to store. From that, the protocol buffer compiler creates a class that
implements automatic encoding and parsing of the protocol buffer data with an
efficient binary format. The generated class provides getters and setters for
the fields that make up a protocol buffer and takes care of the details of
reading and writing the protocol buffer as a unit. Importantly, the protocol
buffer format supports the idea of extending the format over time in such a way
that the code can still read data encoded with the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>The example code is included in the source code package, under the
<a href=https://github.com/protocolbuffers/protobuf/tree/main/examples>&ldquo;examples&rdquo; directory</a>.</p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. Here is the <code>.proto</code> file that defines your messages,
<code>addressbook.proto</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto2&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>HOME</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>As you can see, the syntax is similar to C++ or Java. Let&rsquo;s go through each part
of the file and see what it does.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects. In C++, your generated classes will
be placed in a namespace matching the package name.</p><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types &ndash; in the above example the <code>Person</code> message contains <code>PhoneNumber</code>
messages, while the <code>AddressBook</code> message contains <code>Person</code> messages. You can
even define message types nested inside other messages &ndash; as you can see, the
<code>PhoneNumber</code> type is defined inside <code>Person</code>. You can also define <code>enum</code> types
if you want one of your fields to have one of a predefined list of values &ndash;
here you want to specify that a phone number can be one of the following phone
types: <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>Each field must be annotated with one of the following modifiers:</p><ul><li><code>optional</code>: the field may or may not be set. If an optional field value
isn&rsquo;t set, a default value is used. For simple types, you can specify your
own default value, as we&rsquo;ve done for the phone number <code>type</code> in the example.
Otherwise, a system default is used: zero for numeric types, the empty
string for strings, false for bools. For embedded messages, the default
value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of the message, which
has none of its fields set. Calling the accessor to get the value of an
optional (or required) field which has not been explicitly set always
returns that field&rsquo;s default value.</li><li><code>repeated</code>: the field may be repeated any number of times (including zero).
The order of the repeated values will be preserved in the protocol buffer.
Think of repeated fields as dynamically sized arrays.</li><li><code>required</code>: a value for the field must be provided, otherwise the message
will be considered &ldquo;uninitialized&rdquo;. If <code>libprotobuf</code> is compiled in debug
mode, serializing an uninitialized message will cause an assertion failure.
In optimized builds, the check is skipped and the message will be written
anyway. However, parsing an uninitialized message will always fail (by
returning <code>false</code> from the parse method). Other than this, a required field
behaves exactly like an optional field.</li></ul><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Required Is Forever</strong>
You should be very careful about marking fields as <code>required</code>. If at some point
you wish to stop writing or sending a required field, it will be problematic to
change the field to an optional field &ndash; old readers will consider messages
without this field to be incomplete and may reject or drop them unintentionally.
You should consider writing application-specific custom validation routines for
your buffers instead. Within Google, <code>required</code> fields are strongly disfavored;
most messages defined in proto2 syntax use <code>optional</code> and <code>repeated</code> only.
(Proto3 does not support <code>required</code> fields at all.)</div><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto>Protocol Buffer Language Guide</a>.
Don&rsquo;t go looking for facilities similar to class inheritance, though &ndash; protocol
buffers don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence <code>Person</code> and
<code>PhoneNumber</code>) messages. To do this, you need to run the protocol buffer
compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as <code>$SRC_DIR</code>), and the path to your
<code>.proto</code>. In this case, you&mldr;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --cpp_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want C++ classes, you use the <code>--cpp_out</code> option &ndash; similar
options are provided for other supported languages.</p></li></ol><p>This generates the following files in your specified destination directory:</p><ul><li><code>addressbook.pb.h</code>, the header which declares your generated classes.</li><li><code>addressbook.pb.cc</code>, which contains the implementation of your classes.</li></ul><h2 id=protobuf-api>The Protocol Buffer API</h2><p>Let&rsquo;s look at some of the generated code and see what classes and functions the
compiler has created for you. If you look in <code>addressbook.pb.h</code>, you can see
that you have a class for each message you specified in <code>addressbook.proto</code>.
Looking closer at the <code>Person</code> class, you can see that the compiler has
generated accessors for each field. For example, for the <code>name</code>, <code>id</code>, <code>email</code>,
and <code>phones</code> fields, you have these methods:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// name
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>has_name</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_name</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>name</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_name</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>mutable_name</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// id
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>has_id</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_id</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>int32_t</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_id</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int32_t</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// email
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>bool</span> <span style=color:#000>has_email</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_email</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_email</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>set_email</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>value</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>std</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>string</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>mutable_email</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// phones
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>phones_size</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>clear_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RepeatedPtrField</span><span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span> <span style=color:#ce5c00;font-weight:700>&gt;&amp;</span> <span style=color:#000>phones</span><span style=color:#000;font-weight:700>()</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>RepeatedPtrField</span><span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span> <span style=color:#ce5c00;font-weight:700>&gt;*</span> <span style=color:#000>mutable_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#204a87;font-weight:700>const</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>phones</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>const</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>mutable_phones</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>inline</span> <span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>add_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span></code></pre></div><p>As you can see, the getters have exactly the name as the field in lowercase, and
the setter methods begin with <code>set_</code>. There are also <code>has_</code> methods for each
singular (required or optional) field which return true if that field has been
set. Finally, each field has a <code>clear_</code> method that un-sets the field back to
its empty state.</p><p>While the numeric <code>id</code> field just has the basic accessor set described above,
the <code>name</code> and <code>email</code> fields have a couple of extra methods because they&rsquo;re
strings &ndash; a <code>mutable_</code> getter that lets you get a direct pointer to the string,
and an extra setter. Note that you can call <code>mutable_email()</code> even if <code>email</code> is
not already set; it will be initialized to an empty string automatically. If you
had a repeated message field in this example, it would also have a <code>mutable_</code>
method but not a <code>set_</code> method.</p><p>Repeated fields also have some special methods &ndash; if you look at the methods for
the repeated <code>phones</code> field, you&rsquo;ll see that you can</p><ul><li>check the repeated field&rsquo;s <code>_size</code> (in other words, how many phone numbers
are associated with this <code>Person</code>).</li><li>get a specified phone number using its index.</li><li>update an existing phone number at the specified index.</li><li>add another phone number to the message which you can then edit (repeated
scalar types have an <code>add_</code> that just lets you pass in the new value).</li></ul><p>For more information on exactly what members the protocol compiler generates for
any particular field definition, see the
<a href=/reference/cpp/cpp-generated>C++ generated code reference</a>.</p><h3 id=enums-nested-classes>Enums and Nested Classes</h3><p>The generated code includes a <code>PhoneType</code> enum that corresponds to your <code>.proto</code>
enum. You can refer to this type as <code>Person::PhoneType</code> and its values as
<code>Person::MOBILE</code>, <code>Person::HOME</code>, and <code>Person::WORK</code> (the implementation details
are a little more complicated, but you don&rsquo;t need to understand them to use the
enum).</p><p>The compiler has also generated a nested class for you called
<code>Person::PhoneNumber</code>. If you look at the code, you can see that the &ldquo;real&rdquo;
class is actually called <code>Person_PhoneNumber</code>, but a typedef defined inside
<code>Person</code> allows you to treat it as if it were a nested class. The only case
where this makes a difference is if you want to forward-declare the class in
another file &ndash; you cannot forward-declare nested types in C++, but you can
forward-declare <code>Person_PhoneNumber</code>.</p><h3 id=standard-message-methods>Standard Message Methods</h3><p>Each message class also contains a number of other methods that let you check or
manipulate the entire message, including:</p><ul><li><code>bool IsInitialized() const;</code>: checks if all the required fields have been
set.</li><li><code>string DebugString() const;</code>: returns a human-readable representation of
the message, particularly useful for debugging.</li><li><code>void CopyFrom(const Person& from);</code>: overwrites the message with the given
message&rsquo;s values.</li><li><code>void Clear();</code>: clears all the elements back to the empty state.</li></ul><p>These and the I/O methods described in the following section implement the
<code>Message</code> interface shared by all C++ protocol buffer classes. For more info,
see the
<a href=/reference/cpp/api-docs/google.protobuf.message#Message>complete API documentation for <code>Message</code></a>.</p><h3 id=parsing-serialization>Parsing and Serialization</h3><p>Finally, each protocol buffer class has methods for writing and reading messages
of your chosen type using the protocol buffer
<a href=/programming-guides/encoding>binary format</a>. These
include:</p><ul><li><code>bool SerializeToString(string* output) const;</code>: serializes the message and
stores the bytes in the given string. Note that the bytes are binary, not
text; we only use the <code>string</code> class as a convenient container.</li><li><code>bool ParseFromString(const string& data);</code>: parses a message from the given
string.</li><li><code>bool SerializeToOstream(ostream* output) const;</code>: writes the message to the
given C++ <code>ostream</code>.</li><li><code>bool ParseFromIstream(istream* input);</code>: parses a message from the given
C++ <code>istream</code>.</li></ul><p>These are just a couple of the options provided for parsing and serialization.
Again, see the
<a href=/reference/cpp/api-docs/google.protobuf.message#Message><code>Message</code> API reference</a>
for a complete list.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Protocol Buffers and Object Oriented Design</strong>
Protocol buffer classes are basically data holders (like structs in C) that
don&rsquo;t provide additional functionality; they don&rsquo;t make good first class
citizens in an object model. If you want to add richer behavior to a generated
class, the best way to do this is to wrap the generated protocol buffer class in
an application-specific class. Wrapping protocol buffers is also a good idea if
you don&rsquo;t have control over the design of the <code>.proto</code> file (if, say, you&rsquo;re
reusing one from another project). In that case, you can use the wrapper class
to craft an interface better suited to the unique environment of your
application: hiding some data and methods, exposing convenience functions, etc.
<strong>You should never add behavior to the generated classes by inheriting from
them</strong>. This will break internal mechanisms and is not good object-oriented
practice anyway.</div><h2 id=writing-a-message>Writing a Message</h2><p>Now let&rsquo;s try using your protocol buffer classes. The first thing you want your
address book application to be able to do is write personal details to your
address book file. To do this, you need to create and populate instances of your
protocol buffer classes and then write them to an output stream.</p><p>Here is a program which reads an <code>AddressBook</code> from a file, adds one new
<code>Person</code> to it based on user input, and writes the new <code>AddressBook</code> back out to
the file again. The parts which directly call or reference code generated by the
protocol compiler are highlighted.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;iostream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;fstream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;string&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;addressbook.pb.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>std</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This function fills in a Person message based on user input.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>PromptForAddress</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter person ID number: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>cin</span> <span style=color:#ce5c00;font-weight:700>&gt;&gt;</span> <span style=color:#000>id</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_id</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>cin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ignore</span><span style=color:#000;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>256</span><span style=color:#000;font-weight:700>,</span> <span style=color:#4e9a06>&#39;\n&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter name: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>mutable_name</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter email address (blank for none): &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>string</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>empty</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_email</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87>true</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Enter a phone number (or leave blank to finish): &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>string</span> <span style=color:#000>number</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>number</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>empty</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>phone_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>add_phones</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_number</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Is this a mobile, home, or work phone? &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>string</span> <span style=color:#000>type</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>getline</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>cin</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>type</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;mobile&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>MOBILE</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;home&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>HOME</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>-&gt;</span><span style=color:#000>set_type</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>WORK</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Unknown phone type.  Using default.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Main function:  Reads the entire address book from a file,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   adds one person based on user input, then writes it back out to the same
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Verify that the version of the library that we linked against is
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// compatible with the version of the headers we compiled against.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>GOOGLE_PROTOBUF_VERIFY_VERSION</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>argc</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Usage:  &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34; ADDRESS_BOOK_FILE&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>AddressBook</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>fstream</span> <span style=color:#000>input</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>in</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>binary</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;: File not found.  Creating a new file.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromIstream</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Failed to parse address book.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Add an address.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>PromptForAddress</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>add_people</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Write the new address book back to disk.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>fstream</span> <span style=color:#000>output</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>out</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>trunc</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>binary</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>SerializeToOstream</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>output</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Failed to write address book.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Optional:  Delete all global objects allocated by libprotobuf.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>ShutdownProtobufLibrary</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Notice the <code>GOOGLE_PROTOBUF_VERIFY_VERSION</code> macro. It is good practice &ndash; though
not strictly necessary &ndash; to execute this macro before using the C++ Protocol
Buffer library. It verifies that you have not accidentally linked against a
version of the library which is incompatible with the version of the headers you
compiled with. If a version mismatch is detected, the program will abort. Note
that every <code>.pb.cc</code> file automatically invokes this macro on startup.</p><p>Also notice the call to <code>ShutdownProtobufLibrary()</code> at the end of the program.
All this does is delete any global objects that were allocated by the Protocol
Buffer library. This is unnecessary for most programs, since the process is just
going to exit anyway and the OS will take care of reclaiming all of its memory.
However, if you use a memory leak checker that requires that every last object
be freed, or if you are writing a library which may be loaded and unloaded
multiple times by a single process, then you may want to force Protocol Buffers
to clean up everything.</p><h2 id=reading-a-message>Reading a Message</h2><p>Of course, an address book wouldn&rsquo;t be much use if you couldn&rsquo;t get any
information out of it! This example reads the file created by the above example
and prints all the information in it.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;iostream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;fstream&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&lt;string&gt;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#include</span> <span style=color:#8f5902;font-style:italic>&#34;addressbook.pb.h&#34;</span><span style=color:#8f5902;font-style:italic>
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#204a87;font-weight:700>namespace</span> <span style=color:#000>std</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Iterates though all people in the AddressBook and prints info about them.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>ListPeople</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>AddressBook</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>i</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>people_size</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>i</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>people</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>i</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Person ID: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>id</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Name: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>has_email</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  E-mail address: &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span> <span style=color:#000>j</span> <span style=color:#ce5c00;font-weight:700>&lt;</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phones_size</span><span style=color:#000;font-weight:700>();</span> <span style=color:#000>j</span><span style=color:#ce5c00;font-weight:700>++</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>const</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&amp;</span> <span style=color:#000>phone_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>j</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>phone_number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#f57900>MOBILE</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Mobile phone #: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#f57900>HOME</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Home phone #: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#f57900>WORK</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;  Work phone #: &#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cout</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>phone_number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Main function:  Reads the entire address book from a file and prints all
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>//   the information inside.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>argc</span><span style=color:#000;font-weight:700>,</span> <span style=color:#204a87;font-weight:700>char</span><span style=color:#ce5c00;font-weight:700>*</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[])</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Verify that the version of the library that we linked against is
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>// compatible with the version of the headers we compiled against.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>GOOGLE_PROTOBUF_VERIFY_VERSION</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>argc</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Usage:  &#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34; ADDRESS_BOOK_FILE&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>tutorial</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>AddressBook</span> <span style=color:#000>address_book</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>fstream</span> <span style=color:#000>input</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>in</span> <span style=color:#ce5c00;font-weight:700>|</span> <span style=color:#000>ios</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>binary</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFromIstream</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>))</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>cerr</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#4e9a06>&#34;Failed to parse address book.&#34;</span> <span style=color:#ce5c00;font-weight:700>&lt;&lt;</span> <span style=color:#000>endl</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>return</span> <span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>ListPeople</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Optional:  Delete all global objects allocated by libprotobuf.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>google</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>protobuf</span><span style=color:#ce5c00;font-weight:700>::</span><span style=color:#000>ShutdownProtobufLibrary</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>must not</em> add or delete any required fields.</li><li>you <em>may</em> delete optional or repeated fields.</li><li>you <em>may</em> add new optional or repeated fields but you must use fresh tag
numbers (that is, tag numbers that were never used in this protocol buffer,
not even by deleted fields).</li></ul><p>(There are
<a href=/programming-guides/proto#updating>some exceptions</a> to
these rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, optional fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages. However, keep in mind that new
optional fields will not be present in old messages, so you will need to either
check explicitly whether they&rsquo;re set with <code>has_</code>, or provide a reasonable
default value in your <code>.proto</code> file with <code>[default = value]</code> after the tag
number. If the default value is not specified for an optional element, a
type-specific default value is used instead: for strings, the default value is
the empty string. For booleans, the default value is false. For numeric types,
the default value is zero. Note also that if you added a new repeated field,
your new code will not be able to tell whether it was left empty (by new code)
or never set at all (by old code) since there is no <code>has_</code> flag for it.</p><h2 id=optimization>Optimization Tips</h2><p>The C++ Protocol Buffers library is extremely heavily optimized. However, proper
usage can improve performance even more. Here are some tips for squeezing every
last drop of speed out of the library:</p><ul><li>Reuse message objects when possible. Messages try to keep around any memory
they allocate for reuse, even when they are cleared. Thus, if you are
handling many messages with the same type and similar structure in
succession, it is a good idea to reuse the same message object each time to
take load off the memory allocator. However, objects can become bloated over
time, especially if your messages vary in &ldquo;shape&rdquo; or if you occasionally
construct a message that is much larger than usual. You should monitor the
sizes of your message objects by calling the <code>SpaceUsed</code> method and delete
them once they get too big.</li><li>Your system&rsquo;s memory allocator may not be well-optimized for allocating lots
of small objects from multiple threads. Try using
<a href=https://github.com/google/tcmalloc>Google&rsquo;s TCMalloc</a> instead.</li></ul><h2 id=advanced-usage>Advanced Usage</h2><p>Protocol buffers have uses that go beyond simple accessors and serialization. Be
sure to explore the <a href=/reference/cpp>C++ API reference</a>
to see what else you can do with them.</p><p>One key feature provided by protocol message classes is <em>reflection</em>. You can
iterate over the fields of a message and manipulate their values without writing
your code against any specific message type. One very useful way to use
reflection is for converting protocol messages to and from other encodings, such
as XML or JSON. A more advanced use of reflection might be to find differences
between two messages of the same type, or to develop a sort of &ldquo;regular
expressions for protocol messages&rdquo; in which you can write expressions that match
certain message contents. If you use your imagination, it&rsquo;s possible to apply
Protocol Buffers to a much wider range of problems than you might initially
expect!</p><p>Reflection is provided by the
<a href=/reference/cpp/api-docs/google.protobuf.message#Reflection><code>Message::Reflection</code> interface</a>.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-c37cedc15574a7fcfc38b58898222d81>2 - Protocol Buffer Basics: C#</h1><div class=lead>This tutorial provides a basic C# programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic C# programmer&rsquo;s introduction to working with
protocol buffers, using the <a href=/programming-guides/proto3>proto3</a> version of
the protocol buffers language. By walking through creating a simple example
application, it shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the C# protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in C#. For more
detailed reference information, see the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>, the
<a href=/reference/csharp/api-docs>C# API Reference</a>, the
<a href=/reference/csharp/csharp-generated>C# Generated Code Guide</a>,
and the <a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>Use .NET binary serialization with
<code>System.Runtime.Serialization.Formatters.Binary.BinaryFormatter</code> and
associated classes. This ends up being very fragile in the face of changes,
expensive in terms of data size in some cases. It also doesn&rsquo;t work very
well if you need to share data with applications written for other
platforms.</li><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Protocol buffers are the flexible, efficient, automated solution to solve
exactly this problem. With protocol buffers, you write a <code>.proto</code> description of
the data structure you wish to store. From that, the protocol buffer compiler
creates a class that implements automatic encoding and parsing of the protocol
buffer data with an efficient binary format. The generated class provides
getters and setters for the fields that make up a protocol buffer and takes care
of the details of reading and writing the protocol buffer as a unit.
Importantly, the protocol buffer format supports the idea of extending the
format over time in such a way that the code can still read data encoded with
the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>Our example is a command-line application for managing an address book data
file, encoded using protocol buffers. The command <code>AddressBook</code> (see:
<a href=//github.com/protocolbuffers/protobuf/blob/master/csharp/src/AddressBook/Program.cs>Program.cs</a>)
can add a new entry to the data file or parse the data file and print the data
to the console.</p><p>You can find the complete example in the
<a href=https://github.com/protocolbuffers/protobuf/tree/master/examples>examples directory</a>
and
<a href=https://github.com/protocolbuffers/protobuf/tree/master/csharp/src/AddressBook><code>csharp/src/AddressBook</code> directory</a>
of the GitHub repository.</p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. In our example, the <code>.proto</code> file that defines the
messages is
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/addressbook.proto><code>addressbook.proto</code></a>.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/timestamp.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In C#, your generated classes will be placed in a namespace matching the
<code>package</code> name if <code>csharp_namespace</code> is not specified. In our example, the
<code>csharp_namespace</code> option has been specified to override the default, so the
generated code uses a namespace of <code>Google.Protobuf.Examples.AddressBook</code>
instead of <code>Tutorial</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#000>option</span> <span style=color:#000>csharp_namespace</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;Google.Protobuf.Examples.AddressBook&#34;</span><span style=color:#000;font-weight:700>;</span>
</span></span></code></pre></div><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic>// Unique ID number for this person.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>google.protobuf.Timestamp</span> <span style=color:#000>last_updated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Our address book file is just one of these.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In the above example, the <code>Person</code> message contains <code>PhoneNumber</code> messages,
while the <code>AddressBook</code> message contains <code>Person</code> messages. You can even define
message types nested inside other messages &ndash; as you can see, the <code>PhoneNumber</code>
type is defined inside <code>Person</code>. You can also define <code>enum</code> types if you want
one of your fields to have one of a predefined list of values &ndash; here you want
to specify that a phone number can be one of <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>If a field value isn&rsquo;t set, a
<a href=/programming-guides/proto3#default>default value</a> is used: zero for
numeric types, the empty string for strings, false for bools. For embedded
messages, the default value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of
the message, which has none of its fields set. Calling the accessor to get the
value of a field which has not been explicitly set always returns that field&rsquo;s
default value.</p><p>If a field is <code>repeated</code>, the field may be repeated any number of times
(including zero). The order of the repeated values will be preserved in the
protocol buffer. Think of repeated fields as dynamically sized arrays.</p><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>. Don&rsquo;t go
looking for facilities similar to class inheritance, though &ndash; protocol buffers
don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence <code>Person</code> and
<code>PhoneNumber</code>) messages. To do this, you need to run the protocol buffer
compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as <code>$SRC_DIR</code>), and the path to your
<code>.proto</code>. In this case, you would invoke:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --csharp_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want C# code, you use the <code>--csharp_out</code> option &ndash; similar
options are provided for other supported languages.</p></li></ol><p>This generates <code>Addressbook.cs</code> in your specified destination directory. To
compile this code, you&rsquo;ll need a project with a reference to the
<code>Google.Protobuf</code> assembly.</p><h2 id=addressbook-classes>The Addressbook Classes</h2><p>Generating <code>Addressbook.cs</code> gives you five useful types:</p><ul><li>A static <code>Addressbook</code> class that contains metadata about the protocol
buffer messages.</li><li>An <code>AddressBook</code> class with a read-only <code>People</code> property.</li><li>A <code>Person</code> class with properties for <code>Name</code>, <code>Id</code>, <code>Email</code> and <code>Phones</code>.</li><li>A <code>PhoneNumber</code> class, nested in a static <code>Person.Types</code> class.</li><li>A <code>PhoneType</code> enum, also nested in <code>Person.Types</code>.</li></ul><p>You can read more about the details of exactly what&rsquo;s generated in the
<a href=/reference/csharp/csharp-generated>C# Generated Code guide</a>,
but for the most part you can treat these as perfectly ordinary C# types. One
point to highlight is that any properties corresponding to repeated fields are
read-only. You can add items to the collection or remove items from it, but you
can&rsquo;t replace it with an entirely separate collection. The collection type for
repeated fields is always <code>RepeatedField&lt;T></code>. This type is like <code>List&lt;T></code> but
with a few extra convenience methods, such as an <code>Add</code> overload accepting a
collection of items, for use in collection initializers.</p><p>Here&rsquo;s an example of how you might create an instance of Person:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#000>Person</span> <span style=color:#000>john</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Person</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Id</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;John Doe&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Email</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdoe@example.com&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Phones</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Types</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Number</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;555-4321&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Types</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Home</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>};</span>
</span></span></code></pre></div><p>Note that with C# 6, you can use <code>using static</code> to remove the <code>Person.Types</code>
ugliness:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Add this to the other using directives</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>static</span> <span style=color:#000>Google</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Protobuf</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Examples</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Types</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// The earlier Phones assignment can now be simplified to:</span>
</span></span><span style=display:flex><span><span style=color:#000>Phones</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>Number</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#4e9a06>&#34;555-4321&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HOME</span> <span style=color:#000;font-weight:700>}</span> <span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=parsing-serialization>Parsing and Serialization</h2><p>The whole purpose of using protocol buffers is to serialize your data so that it
can be parsed elsewhere. Every generated class has a
<code>WriteTo(CodedOutputStream)</code> method, where <code>CodedOutputStream</code> is a class in the
protocol buffer runtime library. However, usually you&rsquo;ll use one of the
extension methods to write to a regular <code>System.IO.Stream</code> or convert the
message to a byte array or <code>ByteString</code>. These extension messages are in the
<code>Google.Protobuf.MessageExtensions</code> class, so when you want to serialize you&rsquo;ll
usually want a <code>using</code> directive for the <code>Google.Protobuf</code> namespace. For
example:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000>Google.Protobuf</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#000>Person</span> <span style=color:#000>john</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000;font-weight:700>...;</span> <span style=color:#8f5902;font-style:italic>// Code as before</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>output</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>File</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Create</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;john.dat&#34;</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>john</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WriteTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>output</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>Parsing is also simple. Each generated class has a static <code>Parser</code> property
which returns a <code>MessageParser&lt;T></code> for that type. That in turn has methods to
parse streams, byte arrays and <code>ByteString</code>s. So to parse the file we&rsquo;ve just
created, we can use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#000>Person</span> <span style=color:#000>john</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>using</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>input</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>File</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>OpenRead</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;john.dat&#34;</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>john</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Parser</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ParseFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><p>A full example program to maintain an addressbook (adding new entries and
listing existing ones) using these messages is available
<a href=https://github.com/protocolbuffers/protobuf/tree/master/csharp/src/AddressBook>in the Github repository</a>.</p><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>may</em> delete fields.</li><li>you <em>may</em> add new fields but you must use fresh tag numbers (i.e. tag
numbers that were never used in this protocol buffer, not even by deleted
fields).</li></ul><p>(There are <a href=/programming-guides/proto3#updating>some exceptions</a> to these
rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, singular fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages.</p><p>However, keep in mind that new fields will not be present in old messages, so
you will need to do something reasonable with the default value. A type-specific
<a href=/programming-guides/proto3#default>default value</a> is used: for strings,
the default value is the empty string. For booleans, the default value is false.
For numeric types, the default value is zero.</p><h2 id=reflection>Reflection</h2><p>Message descriptors (the information in the <code>.proto</code> file) and instances of
messages can be examined programmatically using the reflection API. This can be
useful when writing generic code such as a different text format or a smart diff
tool. Each generated class has a static <code>Descriptor</code> property, and the
descriptor for any instance can be retrieved using the <code>IMessage.Descriptor</code>
property. As a quick example of how these can be used, here is a short method to
print the top-level fields of any message.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>PrintMessage</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>IMessage</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>descriptor</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>message</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Descriptor</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>foreach</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>var</span> <span style=color:#000>field</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>descriptor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fields</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>InDeclarationOrder</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Console</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WriteLine</span><span style=color:#000;font-weight:700>(</span>
</span></span><span style=display:flex><span>            <span style=color:#4e9a06>&#34;Field {0} ({1}): {2}&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000>field</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>FieldNumber</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000>field</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Name</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>            <span style=color:#000>field</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Accessor</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>GetValue</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div></div><div class=td-content style=page-break-before:always><h1 id=pg-57e77ec44bbffe514c16fdf04681bbd0>3 - Protocol Buffer Basics: Dart</h1><div class=lead>This tutorial provides a basic Dart programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic Dart programmer&rsquo;s introduction to working with
protocol buffers, using the <a href=/programming-guides/proto3>proto3</a> version of
the protocol buffers language. By walking through creating a simple example
application, it shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the Dart protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in Dart . For more
detailed reference information, see the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>, the
<a href=https://www.dartlang.org/guides/language/language-tour>Dart Language Tour,</a>
the <a href=https://pub.dartlang.org/documentation/protobuf>Dart API Reference</a>, the
<a href=/reference/dart/dart-generated>Dart Generated Code Guide</a>,
and the <a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Protocol buffers are the flexible, efficient, automated solution to solve
exactly this problem. With protocol buffers, you write a
<code>.proto</code> description of the data structure you wish to
store. From that, the protocol buffer compiler creates a class that implements
automatic encoding and parsing of the protocol buffer data with an efficient
binary format. The generated class provides getters and setters for the fields
that make up a protocol buffer and takes care of the details of reading and
writing the protocol buffer as a unit. Importantly, the protocol buffer format
supports the idea of extending the format over time in such a way that the code
can still read data encoded with the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>Our example is a set of command-line applications for managing an address book
data file, encoded using protocol buffers. The command <code>dart add_person.dart</code>
adds a new entry to the data file. The command <code>dart list_people.dart</code> parses
the data file and prints the data to the console.</p><p>You can find the complete example in the
<a href=https://github.com/protocolbuffers/protobuf/tree/master/examples>examples directory</a>
of the GitHub repository.</p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. In our example, the <code>.proto</code> file that defines the
messages is
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/addressbook.proto><code>addressbook.proto</code></a>.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/timestamp.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic>// Unique ID number for this person.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>google.protobuf.Timestamp</span> <span style=color:#000>last_updated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Our address book file is just one of these.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In the above example, the <code>Person</code> message contains <code>PhoneNumber</code> messages,
while the <code>AddressBook</code> message contains <code>Person</code>
messages. You can even define message types nested inside other messages &ndash; as
you can see, the <code>PhoneNumber</code> type is defined inside <code>Person</code>. You can also
define <code>enum</code> types if you want one of your fields to have one of a predefined
list of values &ndash; here you want to specify that a phone number can be one of
<code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>If a field value isn&rsquo;t set, a
<a href=/programming-guides/proto3#default>default value</a> is used: zero for
numeric types, the empty string for strings, false for bools. For embedded
messages, the default value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of
the message, which has none of its fields set. Calling the accessor to get the
value of a field which has not been explicitly set always returns that field&rsquo;s
default value.</p><p>If a field is <code>repeated</code>, the field may be repeated any number of times
(including zero). The order of the repeated values will be preserved in the
protocol buffer. Think of repeated fields as dynamically sized arrays.</p><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>. Don&rsquo;t go
looking for facilities similar to class inheritance, though &ndash; protocol buffers
don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence
<code>Person</code> and <code>PhoneNumber</code>) messages. To do this, you
need to run the protocol buffer compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Install the Dart Protocol Buffer plugin as described in
<a href=https://github.com/google/protobuf.dart/tree/master/protoc_plugin#how-to-build>its README</a>.
The executable <code>bin/protoc-gen-dart</code> must be in your <code>PATH</code> for the protocol
buffer <code>protoc</code> to find it.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as
<code>$SRC_DIR</code>), and the path to your <code>.proto</code>. In
this case, you would invoke:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --dart_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want Dart code, you use the
<code>--dart_out</code> option &ndash; similar options are
provided for other supported languages.</p></li></ol><p>This generates <code>addressbook.pb.dart</code> in your specified destination directory.</p><h2 id=protobuf-api>The Protocol Buffer API</h2><p>Generating <code>addressbook.pb.dart</code> gives you the following useful types:</p><ul><li>An <code>AddressBook</code> class with a <code>List&lt;Person> get people</code> getter.</li><li>A <code>Person</code> class with accessor methods for <code>name</code>, <code>id</code>, <code>email</code> and
<code>phones</code>.</li><li>A <code>Person_PhoneNumber</code> class, with accessor methods for <code>number</code> and
<code>type</code>.</li><li>A <code>Person_PhoneType</code> class with static fields for each value in the
<code>Person.PhoneType</code> enum.</li></ul><p>You can read more about the details of exactly what&rsquo;s generated in the
<a href=/reference/dart/dart-generated>Dart Generated Code guide</a>.</p><h2 id=writing-a-message>Writing a Message</h2><p>Now let&rsquo;s try using your protocol buffer classes. The first thing you want your
address book application to be able to do is write personal details to your
address book file. To do this, you need to create and populate instances of your
protocol buffer classes and then write them to an output stream.</p><p>Here is a program which reads an <code>AddressBook</code> from a file, adds one new
<code>Person</code> to it based on user input, and writes the new <code>AddressBook</code> back out to
the file again. The parts which directly call or reference code generated by the
protocol compiler are highlighted.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#39;dart:io&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#39;dart_tutorial/addressbook.pb.dart&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This function fills in a Person message based on user input.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>Person</span> <span style=color:#000>promptForAddress</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Person</span> <span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Enter person ID: &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>String</span> <span style=color:#000>input</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readLineSync</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>int</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>parse</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>input</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Enter name&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readLineSync</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Enter email address (blank for none) : &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>String</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readLineSync</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>isNotEmpty</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>email</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Enter a phone number (or leave blank to finish): &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>String</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readLineSync</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>isEmpty</span><span style=color:#000;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Person_PhoneNumber</span> <span style=color:#000>phoneNumber</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Person_PhoneNumber</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>number</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Is this a mobile, home, or work phone? &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>String</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readLineSync</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>type</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>case</span> <span style=color:#4e9a06>&#39;mobile&#39;</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Person_PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MOBILE</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>case</span> <span style=color:#4e9a06>&#39;home&#39;</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Person_PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HOME</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>case</span> <span style=color:#4e9a06>&#39;work&#39;</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Person_PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WORK</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>default</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Unknown phone type.  Using default.&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Reads the entire address book from a file, adds one person based
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// on user input, then writes it back out to the same file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>List</span> <span style=color:#000>arguments</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Usage: add_person ADDRESS_BOOK_FILE&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>File</span> <span style=color:#000>file</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>File</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>first</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000>AddressBook</span> <span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>!</span><span style=color:#000>file</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>existsSync</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;File not found. Creating new file.&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>addressBook</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>addressBook</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fromBuffer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>file</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readAsBytesSync</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>people</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>promptForAddress</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>  <span style=color:#000>file</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>writeAsBytes</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>writeToBuffer</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=reading-a-message>Reading a Message</h2><p>Of course, an address book wouldn&rsquo;t be much use if you couldn&rsquo;t get any
information out of it! This example reads the file created by the above example
and prints all the information in it.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dart data-lang=dart><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#39;dart:io&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#39;dart_tutorial/addressbook.pb.dart&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#39;dart_tutorial/addressbook.pbenum.dart&#39;</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Iterates though all people in the AddressBook and prints info about them.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>printAddressBook</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>AddressBook</span> <span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>Person</span> <span style=color:#000>person</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>people</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Person ID: </span><span style=color:#4e9a06>${</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>id</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;  Name: </span><span style=color:#4e9a06>${</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>name</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>hasEmail</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;  E-mail address:</span><span style=color:#4e9a06>${</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span><span style=color:#4e9a06>}</span><span style=color:#4e9a06>&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>Person_PhoneNumber</span> <span style=color:#000>phoneNumber</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Person_PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#f57900>MOBILE:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;   Mobile phone #: &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Person_PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#f57900>HOME:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;   Home phone #: &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>Person_PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#f57900>WORK:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;   Work phone #: &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>default</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>          <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;   Unknown phone #: &#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>break</span><span style=color:#000;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Reads the entire address book from a file and prints all
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// the information inside.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>List</span> <span style=color:#000>arguments</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>length</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;Usage: list_person ADDRESS_BOOK_FILE&#39;</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#000>File</span> <span style=color:#000>file</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>File</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>first</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span> <span style=color:#000>AddressBook</span> <span style=color:#000>addressBook</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>fromBuffer</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>file</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>readAsBytesSync</span><span style=color:#000;font-weight:700>());</span>
</span></span><span style=display:flex><span>  <span style=color:#000>printAddressBook</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>may</em> delete fields.</li><li>you <em>may</em> add new fields but you must use fresh tag numbers (i.e. tag
numbers that were never used in this protocol buffer, not even by deleted
fields).</li></ul><p>(There are <a href=/programming-guides/proto3#updating>some exceptions</a> to these
rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, singular fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages.</p><p>However, keep in mind that new fields will not be present in old messages, so
you will need to do something reasonable with the default value. A type-specific
<a href=/programming-guides/proto3#default>default value</a> is used: for strings,
the default value is the empty string. For booleans, the default value is false.
For numeric types, the default value is zero.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-e100e6a28103bb1dde6c2b61e5119bab>4 - Protocol Buffer Basics: Go</h1><div class=lead>This tutorial provides a basic Go programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic Go programmer&rsquo;s introduction to working with
protocol buffers, using the <a href=/programming-guides/proto3>proto3</a> version of
the protocol buffers language. By walking through creating a simple example
application, it shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the Go protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in Go. For more
detailed reference information, see the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>, the
<a href=https://pkg.go.dev/google.golang.org/protobuf/proto>Go API Reference</a>, the
<a href=/reference/go/go-generated>Go Generated Code Guide</a>, and
the <a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>Use <a href=//golang.org/pkg/encoding/gob/>gobs</a> to serialize Go data structures.
This is a good solution in a Go-specific environment, but it doesn&rsquo;t work
well if you need to share data with applications written for other
platforms.</li><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Protocol buffers are the flexible, efficient, automated solution to solve
exactly this problem. With protocol buffers, you write a <code>.proto</code> description of
the data structure you wish to store. From that, the protocol buffer compiler
creates a class that implements automatic encoding and parsing of the protocol
buffer data with an efficient binary format. The generated class provides
getters and setters for the fields that make up a protocol buffer and takes care
of the details of reading and writing the protocol buffer as a unit.
Importantly, the protocol buffer format supports the idea of extending the
format over time in such a way that the code can still read data encoded with
the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>Our example is a set of command-line applications for managing an address book
data file, encoded using protocol buffers. The command <code>add_person_go</code> adds a
new entry to the data file. The command <code>list_people_go</code> parses the data file
and prints the data to the console.</p><p>You can find the complete example in the
<a href=https://github.com/protocolbuffers/protobuf/tree/master/examples>examples directory</a>
of the GitHub repository.</p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. In our example, the <code>.proto</code> file that defines the
messages is
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/addressbook.proto><code>addressbook.proto</code></a>.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/timestamp.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>The <code>go_package</code> option defines the import path of the package which will
contain all the generated code for this file. The Go package name will be the
last path component of the import path. For example, our example will use a
package name of &ldquo;tutorialpb&rdquo;.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>go_package</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;github.com/protocolbuffers/protobuf/examples/go/tutorialpb&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic>// Unique ID number for this person.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>google.protobuf.Timestamp</span> <span style=color:#000>last_updated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Our address book file is just one of these.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In the above example, the <code>Person</code> message contains <code>PhoneNumber</code> messages,
while the <code>AddressBook</code> message contains <code>Person</code> messages. You can even define
message types nested inside other messages &ndash; as you can see, the <code>PhoneNumber</code>
type is defined inside <code>Person</code>. You can also define <code>enum</code> types if you want
one of your fields to have one of a predefined list of values &ndash; here you want
to specify that a phone number can be one of <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>If a field value isn&rsquo;t set, a
<a href=/programming-guides/proto3#default>default value</a> is used: zero for
numeric types, the empty string for strings, false for bools. For embedded
messages, the default value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of
the message, which has none of its fields set. Calling the accessor to get the
value of a field which has not been explicitly set always returns that field&rsquo;s
default value.</p><p>If a field is <code>repeated</code>, the field may be repeated any number of times
(including zero). The order of the repeated values will be preserved in the
protocol buffer. Think of repeated fields as dynamically sized arrays.</p><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>. Don&rsquo;t go
looking for facilities similar to class inheritance, though &ndash; protocol buffers
don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence <code>Person</code> and
<code>PhoneNumber</code>) messages. To do this, you need to run the protocol buffer
compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Run the following command to install the Go protocol buffers plugin:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
</span></span></code></pre></div><p>The compiler plugin <code>protoc-gen-go</code> will be installed in <code>$GOBIN</code>,
defaulting to <code>$GOPATH/bin</code>. It must be in your <code>$PATH</code> for the protocol
compiler <code>protoc</code> to find it.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as <code>$SRC_DIR</code>), and the path to your
<code>.proto</code>. In this case, you would invoke:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --go_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want Go code, you use the <code>--go_out</code> option &ndash; similar options
are provided for other supported languages.</p></li></ol><p>This generates
<code>github.com/protocolbuffers/protobuf/examples/go/tutorialpb/addressbook.pb.go</code>
in your specified destination directory.</p><h2 id=protobuf-api>The Protocol Buffer API</h2><p>Generating <code>addressbook.pb.go</code> gives you the following useful types:</p><ul><li>An <code>AddressBook</code> structure with a <code>People</code> field.</li><li>A <code>Person</code> structure with fields for <code>Name</code>, <code>Id</code>, <code>Email</code> and <code>Phones</code>.</li><li>A <code>Person_PhoneNumber</code> structure, with fields for <code>Number</code> and <code>Type</code>.</li><li>The type <code>Person_PhoneType</code> and a value defined for each value in the
<code>Person.PhoneType</code> enum.</li></ul><p>You can read more about the details of exactly what&rsquo;s generated in the
<a href=/reference/go/go-generated>Go Generated Code guide</a>, but
for the most part you can treat these as perfectly ordinary Go types.</p><p>Here&rsquo;s an example from the
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/go/cmd/list_people/list_people_test.go><code>list_people</code> command&rsquo;s unit tests</a>
of how you might create an instance of Person:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>p</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Id</span><span style=color:#000;font-weight:700>:</span>    <span style=color:#0000cf;font-weight:700>1234</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Name</span><span style=color:#000;font-weight:700>:</span>  <span style=color:#4e9a06>&#34;John Doe&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Email</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;jdoe@example.com&#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Phones</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000;font-weight:700>[]</span><span style=color:#ce5c00;font-weight:700>*</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Person_PhoneNumber</span><span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000;font-weight:700>{</span><span style=color:#000>Number</span><span style=color:#000;font-weight:700>:</span> <span style=color:#4e9a06>&#34;555-4321&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>Type</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Person_HOME</span><span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>},</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=writing-a-message>Writing a Message</h2><p>The whole purpose of using protocol buffers is to serialize your data so that it
can be parsed elsewhere. In Go, you use the <code>proto</code> library&rsquo;s
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Marshal">Marshal</a>
function to serialize your protocol buffer data. A pointer to a protocol buffer
message&rsquo;s <code>struct</code> implements the <code>proto.Message</code> interface. Calling
<code>proto.Marshal</code> returns the protocol buffer, encoded in its wire format. For
example, we use this function in the
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/go/cmd/add_person/add_person.go><code>add_person</code> command</a>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#000>book</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// ...
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Write the new address book back to disk.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Marshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>book</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatalln</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Failed to encode address book:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>ioutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WriteFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fname</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>out</span><span style=color:#000;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0644</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatalln</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Failed to write address book:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=reading-a-message>Reading a Message</h2><p>To parse an encoded message, you use the <code>proto</code> library&rsquo;s
<a href="https://pkg.go.dev/google.golang.org/protobuf/proto?tab=doc#Unmarshal">Unmarshal</a>
function. Calling this parses the data in <code>in</code> as a protocol buffer and places
the result in <code>book</code>. So to parse the file in the
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/go/cmd/list_people/list_people.go><code>list_people</code> command</a>,
we use:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#000>in</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>ioutil</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>ReadFile</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>fname</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatalln</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Error reading file:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000>book</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#ce5c00;font-weight:700>&amp;</span><span style=color:#000>pb</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>:=</span> <span style=color:#000>proto</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Unmarshal</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>in</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>book</span><span style=color:#000;font-weight:700>);</span> <span style=color:#000>err</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#204a87;font-weight:700>nil</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>log</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>Fatalln</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Failed to parse address book:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>err</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>may</em> delete fields.</li><li>you <em>may</em> add new fields but you must use fresh tag numbers (i.e. tag
numbers that were never used in this protocol buffer, not even by deleted
fields).</li></ul><p>(There are <a href=/programming-guides/proto3#updating>some exceptions</a> to these
rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, singular fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages.</p><p>However, keep in mind that new fields will not be present in old messages, so
you will need to do something reasonable with the default value. A type-specific
<a href=/programming-guides/proto3#default>default value</a> is used: for strings,
the default value is the empty string. For booleans, the default value is false.
For numeric types, the default value is zero.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-8d415712a04e782902fbfc8fb9406a26>5 - Protocol Buffer Basics: Java</h1><div class=lead>This tutorial provides a basic Java programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic Java programmer&rsquo;s introduction to working with
protocol buffers. By walking through creating a simple example application, it
shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the Java protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in Java. For more
detailed reference information, see the
<a href=/programming-guides/proto>Protocol Buffer Language Guide (proto2)</a>,
the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide (proto3)</a>,
the
<a href=/reference/java/api-docs/overview-summary.html>Java API Reference</a>,
the
<a href=/reference/java/java-generated>Java Generated Code Guide</a>,
and the
<a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>Use Java Serialization. This is the default approach since it&rsquo;s built into
the language, but it has a host of well-known problems (see Effective Java,
by Josh Bloch pp. 213), and also doesn&rsquo;t work very well if you need to share
data with applications written in C++ or Python.</li><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Instead of these options, you can use protocol buffers. Protocol buffers are the
flexible, efficient, automated solution to solve exactly this problem. With
protocol buffers, you write a <code>.proto</code> description of the data structure you
wish to store. From that, the protocol buffer compiler creates a class that
implements automatic encoding and parsing of the protocol buffer data with an
efficient binary format. The generated class provides getters and setters for
the fields that make up a protocol buffer and takes care of the details of
reading and writing the protocol buffer as a unit. Importantly, the protocol
buffer format supports the idea of extending the format over time in such a way
that the code can still read data encoded with the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>The example code is included in the source code package, under the &ldquo;examples&rdquo;
directory. <a href=/downloads>Download it here.</a></p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. Here is the <code>.proto</code> file that defines your messages,
<code>addressbook.proto</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto2&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_multiple_files</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_package</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;com.example.tutorial.protos&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>option</span> <span style=color:#000>java_outer_classname</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;AddressBookProtos&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>HOME</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>As you can see, the syntax is similar to C++ or Java. Let&rsquo;s go through each part
of the file and see what it does.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects. In Java, the package name is used
as the Java package unless you have explicitly specified a <code>java_package</code>, as we
have here. Even if you do provide a <code>java_package</code>, you should still define a
normal <code>package</code> as well to avoid name collisions in the Protocol Buffers name
space as well as in non-Java languages.</p><p>After the package declaration, you can see three options that are Java-specific:
<code>java_multiple_files</code>, <code>java_package</code>, and <code>java_outer_classname</code>.
<code>java_package</code> specifies in what Java package name your generated classes should
live. If you don&rsquo;t specify this explicitly, it simply matches the package name
given by the <code>package</code> declaration, but these names usually aren&rsquo;t appropriate
Java package names (since they usually don&rsquo;t start with a domain name). The
<code>java_outer_classname</code> option defines the class name of the wrapper class which
will represent this file. If you don&rsquo;t give a <code>java_outer_classname</code> explicitly,
it will be generated by converting the file name to upper camel case. For
example, &ldquo;my_proto.proto&rdquo; would, by default, use &ldquo;MyProto&rdquo; as the wrapper class
name. The <code>java_multiple_files = true</code> option enables generating a separate
<code>.java</code> file for each generated class (instead of the legacy behavior of
generating a single <code>.java</code> file for the wrapper class, using the wrapper class
as an outer class, and nesting all the other classes inside the wrapper class).</p><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types &ndash; in the above example the <code>Person</code> message contains <code>PhoneNumber</code>
messages, while the <code>AddressBook</code> message contains <code>Person</code> messages. You can
even define message types nested inside other messages &ndash; as you can see, the
<code>PhoneNumber</code> type is defined inside <code>Person</code>. You can also define <code>enum</code> types
if you want one of your fields to have one of a predefined list of values &ndash;
here you want to specify that a phone number can be one of the following phone
types: <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>Each field must be annotated with one of the following modifiers:</p><ul><li><code>optional</code>: the field may or may not be set. If an optional field value
isn&rsquo;t set, a default value is used. For simple types, you can specify your
own default value, as we&rsquo;ve done for the phone number <code>type</code> in the example.
Otherwise, a system default is used: zero for numeric types, the empty
string for strings, false for bools. For embedded messages, the default
value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of the message, which
has none of its fields set. Calling the accessor to get the value of an
optional (or required) field which has not been explicitly set always
returns that field&rsquo;s default value.</li><li><code>repeated</code>: the field may be repeated any number of times (including zero).
The order of the repeated values will be preserved in the protocol buffer.
Think of repeated fields as dynamically sized arrays.</li><li><code>required</code>: a value for the field must be provided, otherwise the message
will be considered &ldquo;uninitialized&rdquo;. Trying to build an uninitialized message
will throw a <code>RuntimeException</code>. Parsing an uninitialized message will throw
an <code>IOException</code>. Other than this, a required field behaves exactly like an
optional field.</li></ul><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Required Is Forever</strong>
You should be very careful about marking fields as <code>required</code>. If at some point
you wish to stop writing or sending a required field, it will be problematic to
change the field to an optional field &ndash; old readers will consider messages
without this field to be incomplete and may reject or drop them unintentionally.
You should consider writing application-specific custom validation routines for
your buffers instead. Within Google, <code>required</code> fields are strongly disfavored;
most messages defined in proto2 syntax use <code>optional</code> and <code>repeated</code> only.
(Proto3 does not support <code>required</code> fields at all.)</div><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto>Protocol Buffer Language Guide</a>.
Don&rsquo;t go looking for facilities similar to class inheritance, though &ndash; protocol
buffers don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence <code>Person</code> and
<code>PhoneNumber</code>) messages. To do this, you need to run the protocol buffer
compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as <code>$SRC_DIR</code>), and the path to your
<code>.proto</code>. In this case, you&mldr;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --java_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want Java classes, you use the <code>--java_out</code> option &ndash; similar
options are provided for other supported languages.</p></li></ol><p>This generates a <code>com/example/tutorial/protos/</code> subdirectory in your specified
destination directory, containing a few generated <code>.java</code> files.</p><h2 id=protobuf-api>The Protocol Buffer API</h2><p>Let&rsquo;s look at some of the generated code and see what classes and methods the
compiler has created for you. If you look in <code>com/example/tutorial/protos/</code>, you
can see that it contains <code>.java</code> files defining a class for each message you
specified in <code>addressbook.proto</code>. Each class has its own <code>Builder</code> class that
you use to create instances of that class. You can find out more about builders
in the <a href=#builders-messages>Builders vs. Messages</a> section below.</p><p>Both messages and builders have auto-generated accessor methods for each field
of the message; messages have only getters while builders have both getters and
setters. Here are some of the accessors for the <code>Person</code> class (implementations
omitted for brevity):</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// required string name = 1;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasName</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getName</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// required int32 id = 2;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasId</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getId</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// optional string email = 3;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasEmail</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getEmail</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// repeated .tutorial.Person.PhoneNumber phones = 4;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>getPhonesList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getPhonesCount</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>getPhones</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span></code></pre></div><p>Meanwhile, <code>Person.Builder</code> has the same getters plus setters:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// required string name = 1;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasName</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>java</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>lang</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>String</span> <span style=color:#000>getName</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>setName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>clearName</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// required int32 id = 2;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasId</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getId</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>setId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>clearId</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// optional string email = 3;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>boolean</span> <span style=color:#000>hasEmail</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>String</span> <span style=color:#000>getEmail</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>setEmail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>clearEmail</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// repeated .tutorial.Person.PhoneNumber phones = 4;
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>List</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>getPhonesList</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>getPhonesCount</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>getPhones</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>setPhones</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>int</span> <span style=color:#000>index</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>addPhones</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>PhoneNumber</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>addAllPhones</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Iterable</span><span style=color:#ce5c00;font-weight:700>&lt;</span><span style=color:#000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#000>value</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#000>Builder</span> <span style=color:#000>clearPhones</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><p>As you can see, there are simple JavaBeans-style getters and setters for each
field. There are also <code>has</code> getters for each singular field which return true if
that field has been set. Finally, each field has a <code>clear</code> method that un-sets
the field back to its empty state.</p><p>Repeated fields have some extra methods &ndash; a <code>Count</code> method (which is just
shorthand for the list&rsquo;s size), getters and setters which get or set a specific
element of the list by index, an <code>add</code> method which appends a new element to the
list, and an <code>addAll</code> method which adds an entire container full of elements to
the list.</p><p>Notice how these accessor methods use camel-case naming, even though the
<code>.proto</code> file uses lowercase-with-underscores. This transformation is done
automatically by the protocol buffer compiler so that the generated classes
match standard Java style conventions. You should always use
lowercase-with-underscores for field names in your <code>.proto</code> files; this ensures
good naming practice in all the generated languages. See the
<a href=/programming-guides/style>style guide</a> for more on good
<code>.proto</code> style.</p><p>For more information on exactly what members the protocol compiler generates for
any particular field definition, see the
<a href=/reference/java/java-generated>Java generated code reference</a>.</p><h3 id=enums-nested-classes>Enums and Nested Classes</h3><p>The generated code includes a <code>PhoneType</code> Java 5 enum, nested within <code>Person</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>MOBILE</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>  <span style=color:#000>HOME</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>  <span style=color:#000>WORK</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>,</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#ce5c00;font-weight:700>),</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>...</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><p>The nested type <code>Person.PhoneNumber</code> is generated, as you&rsquo;d expect, as a nested
class within <code>Person</code>.</p><h3 id=builders-messages>Builders vs. Messages</h3><p>The message classes generated by the protocol buffer compiler are all
<em>immutable</em>. Once a message object is constructed, it cannot be modified, just
like a Java <code>String</code>. To construct a message, you must first construct a
builder, set any fields you want to set to your chosen values, then call the
builder&rsquo;s <code>build()</code> method.</p><p>You may have noticed that each method of the builder which modifies the message
returns another builder. The returned object is actually the same builder on
which you called the method. It is returned for convenience so that you can
string several setters together on a single line of code.</p><p>Here&rsquo;s an example of how you would create an instance of <code>Person</code>:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#000>Person</span> <span style=color:#000>john</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newBuilder</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#0000cf;font-weight:700>1234</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;John Doe&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;jdoe@example.com&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addPhones</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newBuilder</span><span style=color:#ce5c00;font-weight:700>()</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setNumber</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;555-4321&#34;</span><span style=color:#ce5c00;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>HOME</span><span style=color:#ce5c00;font-weight:700>))</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span></code></pre></div><h3 id=standard-message-methods>Standard Message Methods</h3><p>Each message and builder class also contains a number of other methods that let
you check or manipulate the entire message, including:</p><ul><li><code>isInitialized()</code>: checks if all the required fields have been set.</li><li><code>toString()</code>: returns a human-readable representation of the message,
particularly useful for debugging.</li><li><code>mergeFrom(Message other)</code>: (builder only) merges the contents of <code>other</code>
into this message, overwriting singular scalar fields, merging composite
fields, and concatenating repeated fields.</li><li><code>clear()</code>: (builder only) clears all the fields back to the empty state.</li></ul><p>These methods implement the <code>Message</code> and <code>Message.Builder</code> interfaces shared by
all Java messages and builders. For more information, see the
<a href=/reference/java/api-docs/com/google/protobuf/Message.html>complete API documentation for <code>Message</code></a>.</p><h3 id=parsing-serialization>Parsing and Serialization</h3><p>Finally, each protocol buffer class has methods for writing and reading messages
of your chosen type using the protocol buffer
<a href=/programming-guides/encoding>binary format</a>. These
include:</p><ul><li><code>byte[] toByteArray();</code>: serializes the message and returns a byte array
containing its raw bytes.</li><li><code>static Person parseFrom(byte[] data);</code>: parses a message from the given
byte array.</li><li><code>void writeTo(OutputStream output);</code>: serializes the message and writes it
to an <code>OutputStream</code>.</li><li><code>static Person parseFrom(InputStream input);</code>: reads and parses a message
from an <code>InputStream</code>.</li></ul><p>These are just a couple of the options provided for parsing and serialization.
Again, see the
<a href=/reference/java/api-docs/com/google/protobuf/Message.html><code>Message</code> API reference</a>
for a complete list.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Protocol Buffers and Object Oriented Design</strong>
Protocol buffer classes are basically data holders (like structs in C) that
don&rsquo;t provide additional functionality; they don&rsquo;t make good first class
citizens in an object model. If you want to add richer behavior to a generated
class, the best way to do this is to wrap the generated protocol buffer class in
an application-specific class. Wrapping protocol buffers is also a good idea if
you don&rsquo;t have control over the design of the <code>.proto</code> file (if, say, you&rsquo;re
reusing one from another project). In that case, you can use the wrapper class
to craft an interface better suited to the unique environment of your
application: hiding some data and methods, exposing convenience functions, etc.
<strong>You should never add behavior to the generated classes by inheriting from
them</strong>. This will break internal mechanisms and is not good object-oriented
practice anyway.</div><h2 id=writing-a-message>Writing a Message</h2><p>Now let&rsquo;s try using your protocol buffer classes. The first thing you want your
address book application to be able to do is write personal details to your
address book file. To do this, you need to create and populate instances of your
protocol buffer classes and then write them to an output stream.</p><p>Here is a program which reads an <code>AddressBook</code> from a file, adds one new
<code>Person</code> to it based on user input, and writes the new <code>AddressBook</code> back out to
the file again. The parts which directly call or reference code generated by the
protocol compiler are highlighted.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.protos.AddressBook</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.protos.Person</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.BufferedReader</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.FileInputStream</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.FileNotFoundException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.FileOutputStream</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.InputStreamReader</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.IOException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.PrintStream</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>AddPerson</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// This function fills in a Person message based on user input.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>static</span> <span style=color:#000>Person</span> <span style=color:#000>PromptForAddress</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>BufferedReader</span> <span style=color:#000>stdin</span><span style=color:#ce5c00;font-weight:700>,</span>
</span></span><span style=display:flex><span>                                 <span style=color:#000>PrintStream</span> <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>IOException</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Builder</span> <span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newBuilder</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter person ID: &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setId</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Integer</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>valueOf</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>stdin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>readLine</span><span style=color:#ce5c00;font-weight:700>()));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter name: &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setName</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>stdin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>readLine</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter email address (blank for none): &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>String</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>readLine</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>&gt;</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setEmail</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>email</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>while</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter a phone number (or leave blank to finish): &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>String</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>readLine</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span><span style=color:#ce5c00;font-weight:700>()</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>break</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Builder</span> <span style=color:#000>phoneNumber</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newBuilder</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>setNumber</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Is this a mobile, home, or work phone? &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>String</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>stdin</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>readLine</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>equals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;mobile&#34;</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>MOBILE</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>equals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;home&#34;</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>HOME</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>type</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>equals</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#ce5c00;font-weight:700>))</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>phoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>setType</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>WORK</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>stdout</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Unknown phone type.  Using default.&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addPhones</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>return</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Main function:  Reads the entire address book from a file,
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>//   adds one person based on user input, then writes it back out to the same
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>//   file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>main</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Usage:  AddPerson ADDRESS_BOOK_FILE&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exit</span><span style=color:#ce5c00;font-weight:700>(-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>AddressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>Builder</span> <span style=color:#000>addressBook</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>AddressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>newBuilder</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#204a87;font-weight:700>try</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>addressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>mergeFrom</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FileInputStream</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>]));</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>catch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>FileNotFoundException</span> <span style=color:#000>e</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;: File not found.  Creating a new file.&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Add an address.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>addressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>addPerson</span><span style=color:#ce5c00;font-weight:700>(</span>
</span></span><span style=display:flex><span>      <span style=color:#000>PromptForAddress</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>BufferedReader</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>InputStreamReader</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>in</span><span style=color:#ce5c00;font-weight:700>)),</span>
</span></span><span style=display:flex><span>                       <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Write the new address book back to disk.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>FileOutputStream</span> <span style=color:#000>output</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FileOutputStream</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>]);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>addressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>build</span><span style=color:#ce5c00;font-weight:700>().</span><span style=color:#c4a000>writeTo</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>output</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#000>output</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>close</span><span style=color:#ce5c00;font-weight:700>();</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=reading-a-message>Reading a Message</h2><p>Of course, an address book wouldn&rsquo;t be much use if you couldn&rsquo;t get any
information out of it! This example reads the file created by the above example
and prints all the information in it.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.protos.AddressBook</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.protos.Person</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.FileInputStream</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.IOException</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.io.PrintStream</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>ListPeople</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Iterates though all people in the AddressBook and prints info about them.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>Print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>AddressBook</span> <span style=color:#000>addressBook</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>addressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getPeopleList</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Person ID: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getId</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;  Name: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getName</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>hasEmail</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;  E-mail address: &#34;</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getEmail</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>for</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>PhoneNumber</span> <span style=color:#000>phoneNumber</span> <span style=color:#ce5c00;font-weight:700>:</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getPhonesList</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>switch</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getType</span><span style=color:#ce5c00;font-weight:700>())</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>MOBILE</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;  Mobile phone #: &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>break</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>HOME</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;  Home phone #: &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>break</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>          <span style=color:#204a87;font-weight:700>case</span> <span style=color:#000>WORK</span><span style=color:#ce5c00;font-weight:700>:</span>
</span></span><span style=display:flex><span>            <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;  Work phone #: &#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>            <span style=color:#204a87;font-weight:700>break</span><span style=color:#ce5c00;font-weight:700>;</span>
</span></span><span style=display:flex><span>        <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>        <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>out</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>getNumber</span><span style=color:#ce5c00;font-weight:700>());</span>
</span></span><span style=display:flex><span>      <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8f5902;font-style:italic>// Main function:  Reads the entire address book from a file and prints all
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#8f5902;font-style:italic>//   the information inside.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>public</span> <span style=color:#204a87;font-weight:700>static</span> <span style=color:#204a87;font-weight:700>void</span> <span style=color:#000>main</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>String</span><span style=color:#ce5c00;font-weight:700>[]</span> <span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#204a87;font-weight:700>throws</span> <span style=color:#000>Exception</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>length</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>err</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>println</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#4e9a06>&#34;Usage:  ListPeople ADDRESS_BOOK_FILE&#34;</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>      <span style=color:#000>System</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>exit</span><span style=color:#ce5c00;font-weight:700>(-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>    <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8f5902;font-style:italic>// Read the existing address book.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>    <span style=color:#000>AddressBook</span> <span style=color:#000>addressBook</span> <span style=color:#ce5c00;font-weight:700>=</span>
</span></span><span style=display:flex><span>      <span style=color:#000>AddressBook</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#c4a000>parseFrom</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#204a87;font-weight:700>new</span> <span style=color:#000>FileInputStream</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#ce5c00;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#ce5c00;font-weight:700>]));</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>Print</span><span style=color:#ce5c00;font-weight:700>(</span><span style=color:#000>addressBook</span><span style=color:#ce5c00;font-weight:700>);</span>
</span></span><span style=display:flex><span>  <span style=color:#ce5c00;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#ce5c00;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>must not</em> add or delete any required fields.</li><li>you <em>may</em> delete optional or repeated fields.</li><li>you <em>may</em> add new optional or repeated fields but you must use fresh tag
numbers (that is, tag numbers that were never used in this protocol buffer,
not even by deleted fields).</li></ul><p>(There are
<a href=/programming-guides/proto#updating>some exceptions</a> to
these rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, optional fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages. However, keep in mind that new
optional fields will not be present in old messages, so you will need to either
check explicitly whether they&rsquo;re set with <code>has_</code>, or provide a reasonable
default value in your <code>.proto</code> file with <code>[default = value]</code> after the tag
number. If the default value is not specified for an optional element, a
type-specific default value is used instead: for strings, the default value is
the empty string. For booleans, the default value is false. For numeric types,
the default value is zero. Note also that if you added a new repeated field,
your new code will not be able to tell whether it was left empty (by new code)
or never set at all (by old code) since there is no <code>has_</code> flag for it.</p><h2 id=advanced-usage>Advanced Usage</h2><p>Protocol buffers have uses that go beyond simple accessors and serialization. Be
sure to explore the
<a href=/reference/java/api-docs/index-all.html>Java API reference</a>
to see what else you can do with them.</p><p>One key feature provided by protocol message classes is <em>reflection</em>. You can
iterate over the fields of a message and manipulate their values without writing
your code against any specific message type. One very useful way to use
reflection is for converting protocol messages to and from other encodings, such
as XML or JSON. A more advanced use of reflection might be to find differences
between two messages of the same type, or to develop a sort of &ldquo;regular
expressions for protocol messages&rdquo; in which you can write expressions that match
certain message contents. If you use your imagination, it&rsquo;s possible to apply
Protocol Buffers to a much wider range of problems than you might initially
expect!</p><p>Reflection is provided as part of the
<a href=/reference/java/api-docs/com/google/protobuf/Message.html><code>Message</code></a>
and
<a href=/reference/java/api-docs/com/google/protobuf/Message.Builder.html><code>Message.Builder</code></a>
interfaces.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-fa8ab8e34046dabb4113b881a4df3c09>6 - Protocol Buffer Basics: Kotlin</h1><div class=lead>This tutorial provides a basic Kotlin programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic Kotlin programmer&rsquo;s introduction to working with
protocol buffers, using the <a href=/programming-guides/proto3>proto3</a> version of
the protocol buffers language. By walking through creating a simple example
application, it shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the Kotlin protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in Kotlin. For more
detailed reference information, see the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>, the
<a href=/reference/kotlin/api-docs>Kotlin API Reference</a>, the
<a href=/reference/kotlin/kotlin-generated>Kotlin Generated Code Guide</a>,
and the <a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>Use kotlinx.serialization. This does not work very well if you need to share
data with applications written in C++ or Python. kotlinx.serialization has a
<a href=https://github.com/Kotlin/kotlinx.serialization/blob/master/docs/formats.md#protobuf-experimental>protobuf mode</a>,
but this does not offer the full features of protocol buffers.</li><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Protocol buffers are the flexible, efficient, automated solution to solve
exactly this problem. With protocol buffers, you write a <code>.proto</code> description of
the data structure you wish to store. From that, the protocol buffer compiler
creates a class that implements automatic encoding and parsing of the protocol
buffer data with an efficient binary format. The generated class provides
getters and setters for the fields that make up a protocol buffer and takes care
of the details of reading and writing the protocol buffer as a unit.
Importantly, the protocol buffer format supports the idea of extending the
format over time in such a way that the code can still read data encoded with
the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>Our example is a set of command-line applications for managing an address book
data file, encoded using protocol buffers. The command <code>add_person_kotlin</code> adds
a new entry to the data file. The command <code>list_people_kotlin</code> parses the data
file and prints the data to the console.</p><p>You can find the complete example in the
<a href=https://github.com/protocolbuffers/protobuf/tree/master/examples>examples directory</a>
of the GitHub repository.</p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. In our example, the <code>.proto</code> file that defines the
messages is
<a href=https://github.com/protocolbuffers/protobuf/blob/master/examples/addressbook.proto><code>addressbook.proto</code></a>.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto3&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#4e9a06>&#34;google/protobuf/timestamp.proto&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span>  <span style=color:#8f5902;font-style:italic>// Unique ID number for this person.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span>  <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000>google.protobuf.Timestamp</span> <span style=color:#000>last_updated</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>5</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#8f5902;font-style:italic>// Our address book file is just one of these.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>In the above example, the <code>Person</code> message contains <code>PhoneNumber</code> messages,
while the <code>AddressBook</code> message contains <code>Person</code> messages. You can even define
message types nested inside other messages &ndash; as you can see, the <code>PhoneNumber</code>
type is defined inside <code>Person</code>. You can also define <code>enum</code> types if you want
one of your fields to have one of a predefined list of values &ndash; here you want
to specify that a phone number can be one of <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>If a field value isn&rsquo;t set, a
<a href=/programming-guides/proto3#default>default value</a> is used: zero for
numeric types, the empty string for strings, false for bools. For embedded
messages, the default value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of
the message, which has none of its fields set. Calling the accessor to get the
value of a field which has not been explicitly set always returns that field&rsquo;s
default value.</p><p>If a field is <code>repeated</code>, the field may be repeated any number of times
(including zero). The order of the repeated values will be preserved in the
protocol buffer. Think of repeated fields as dynamically sized arrays.</p><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide</a>. Don&rsquo;t go
looking for facilities similar to class inheritance, though &ndash; protocol buffers
don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence <code>Person</code> and
<code>PhoneNumber</code>) messages. To do this, you need to run the protocol buffer
compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as <code>$SRC_DIR</code>), and the path to your
<code>.proto</code>. In this case, you would invoke:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --java_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> --kotlin_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want Kotlin code, you use the <code>--kotlin_out</code> option &ndash; similar
options are provided for other supported languages.</p></li></ol><p>Note that if you want to generate Kotlin code you must use both <code>--java_out</code> and
<code>--kotlin_out</code>. This generates a <code>com/example/tutorial/protos/</code> subdirectory in
your specified Java destination directory, containing a few generated <code>.java</code>
files and a <code>com/example/tutorial/protos/</code> subdirectory in your specified Kotlin
destination directory, containing a few generated <code>.kt</code> files.</p><h2 id=protobuf-api>The Protocol Buffer API</h2><p>The protocol buffer compiler for Kotlin generates Kotlin APIs that add to the
existing APIs generated for protocol buffers for Java. This ensures that
codebases written in a mix of Java and Kotlin can interact with the same
protocol buffer message objects without any special handling or conversion.</p><p>Protocol buffers for other Kotlin compilation targets, such as Javascript and
native, are not currently supported.</p><p>Compiling <code>addressbook.proto</code> gives you the following APIs in Java:</p><ul><li>The <code>AddressBook</code> class<ul><li>which, from Kotlin, has the <code>peopleList : List&lt;Person></code> property</li></ul></li><li>The <code>Person</code> class<ul><li>which, from Kotlin, has <code>name</code>, <code>id</code>, <code>email</code>, and <code>phonesList</code>
properties</li><li>the <code>Person.PhoneNumber</code> nested class with <code>number</code> and <code>type</code>
properties</li><li>the <code>Person.PhoneType</code> nested enum</li></ul></li></ul><p>but also generates the following Kotlin APIs:</p><ul><li>The <code>addressBook { ... }</code> and <code>person { ... }</code> factory methods</li><li>A <code>PersonKt</code> object, with a <code>phoneNumber { ... }</code> factory method</li></ul><p>You can read more about the details of exactly what&rsquo;s generated in the
<a href=/reference/kotlin/kotlin-generated>Kotlin Generated Code guide</a>.</p><h2 id=writing-a-message>Writing a Message</h2><p>Now let&rsquo;s try using your protocol buffer classes. The first thing you want your
address book application to be able to do is write personal details to your
address book file. To do this, you need to create and populate instances of your
protocol buffer classes and then write them to an output stream.</p><p>Here is a program which reads an <code>AddressBook</code> from a file, adds one new
<code>Person</code> to it based on user input, and writes the new <code>AddressBook</code> back out to
the file again. The parts which directly call or reference code generated by the
protocol compiler are highlighted.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.Person</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.AddressBook</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.person</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.addressBook</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.PersonKt.phoneNumber</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>java.util.Scanner</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// This function fills in a Person message based on user input.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fun</span> <span style=color:#000>promptPerson</span><span style=color:#000;font-weight:700>():</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>person</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter person ID: &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>id</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>readLine</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>toInt</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter name: &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>name</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>readLine</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter email address (blank for none): &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>email</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>readLine</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>email</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>isNotEmpty</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>email</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>email</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>while</span> <span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>true</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter a phone number (or leave blank to finish): &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>number</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>readLine</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>number</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>isEmpty</span><span style=color:#000;font-weight:700>())</span> <span style=color:#204a87;font-weight:700>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Is this a mobile, home, or work phone? &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>when</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>readLine</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;mobile&#34;</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MOBILE</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;home&#34;</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HOME</span>
</span></span><span style=display:flex><span>      <span style=color:#4e9a06>&#34;work&#34;</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WORK</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Unknown phone type.  Using home.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HOME</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#000>phoneNumber</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>number</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>number</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>this</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>type</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Reads the entire address book from a file, adds one person based
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// on user input, then writes it back out to the same file.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fun</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>size</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Usage: add_person ADDRESS_BOOK_FILE&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>exitProcess</span><span style=color:#000;font-weight:700>(-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>path</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#000>Path</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>single</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>initialAddressBook</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(!</span><span style=color:#000>path</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>exists</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;File not found. Creating new file.&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>addressBook</span> <span style=color:#000;font-weight:700>{}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span> <span style=color:#204a87;font-weight:700>else</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>path</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>inputStream</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>use</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newBuilder</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>mergeFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>it</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>build</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>path</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>outputStream</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>use</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>initialAddressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>copy</span> <span style=color:#000;font-weight:700>{</span> <span style=color:#000>peopleList</span> <span style=color:#ce5c00;font-weight:700>+=</span> <span style=color:#000>promptPerson</span><span style=color:#000;font-weight:700>()</span> <span style=color:#000;font-weight:700>}.</span><span style=color:#000>writeTo</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>it</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=reading-a-message>Reading a Message</h2><p>Of course, an address book wouldn&rsquo;t be much use if you couldn&rsquo;t get any
information out of it! This example reads the file created by the above example
and prints all the information in it.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.Person</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>com.example.tutorial.AddressBook</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>// Iterates though all people in the AddressBook and prints info about them.
</span></span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic></span><span style=color:#204a87;font-weight:700>fun</span> <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>person</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>addressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>peopleList</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Person ID: </span><span style=color:#4e9a06>${person.id}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;  Name: </span><span style=color:#4e9a06>${person.name}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>hasEmail</span><span style=color:#000;font-weight:700>())</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;  Email address: </span><span style=color:#4e9a06>${person.email}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>phoneNumber</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>phonesList</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>val</span> <span style=color:#000>modifier</span> <span style=color:#000;font-weight:700>=</span> <span style=color:#204a87;font-weight:700>when</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>phoneNumber</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>type</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#4e9a06>&#34;Mobile&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#4e9a06>&#34;Home&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#000>Person</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#4e9a06>&#34;Work&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87;font-weight:700>else</span> <span style=color:#ce5c00;font-weight:700>-&gt;</span> <span style=color:#4e9a06>&#34;Unknown&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>      <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;  </span><span style=color:#4e9a06>$modifier</span><span style=color:#4e9a06> phone #: </span><span style=color:#4e9a06>${phoneNumber.number}</span><span style=color:#4e9a06>&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>fun</span> <span style=color:#000>main</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>args</span><span style=color:#000;font-weight:700>:</span> <span style=color:#000>List</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>size</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>println</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Usage: list_person ADDRESS_BOOK_FILE&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#000>exitProcess</span><span style=color:#000;font-weight:700>(-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span>  <span style=color:#000>Path</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>arguments</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>single</span><span style=color:#000;font-weight:700>()).</span><span style=color:#000>inputStream</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>use</span> <span style=color:#000;font-weight:700>{</span>
</span></span><span style=display:flex><span>    <span style=color:#000>print</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>.</span><span style=color:#000>newBuilder</span><span style=color:#000;font-weight:700>().</span><span style=color:#000>mergeFrom</span><span style=color:#000;font-weight:700>(</span><span style=color:#204a87;font-weight:700>it</span><span style=color:#000;font-weight:700>).</span><span style=color:#000>build</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>  <span style=color:#000;font-weight:700>}</span>
</span></span><span style=display:flex><span><span style=color:#000;font-weight:700>}</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>may</em> delete fields.</li><li>you <em>may</em> add new fields but you must use fresh tag numbers (i.e. tag
numbers that were never used in this protocol buffer, not even by deleted
fields).</li></ul><p>(There are <a href=/programming-guides/proto3#updating>some exceptions</a> to these
rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, singular fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages.</p><p>However, keep in mind that new fields will not be present in old messages, so
you will need to do something reasonable with the default value. A type-specific
<a href=/programming-guides/proto3#default>default value</a> is used: for strings,
the default value is the empty string. For booleans, the default value is false.
For numeric types, the default value is zero.</p></div><div class=td-content style=page-break-before:always><h1 id=pg-dd7b75154d644d27da6f4367d70ffff7>7 - Protocol Buffer Basics: Python</h1><div class=lead>This tutorial provides a basic Python programmers introduction to working with protocol buffers.</div><p>This tutorial provides a basic Python programmer&rsquo;s introduction to working with
protocol buffers. By walking through creating a simple example application, it
shows you how to</p><ul><li>Define message formats in a <code>.proto</code> file.</li><li>Use the protocol buffer compiler.</li><li>Use the Python protocol buffer API to write and read messages.</li></ul><p>This isn&rsquo;t a comprehensive guide to using protocol buffers in Python. For more
detailed reference information, see the
<a href=/programming-guides/proto>Protocol Buffer Language Guide (proto2)</a>,
the
<a href=/programming-guides/proto3>Protocol Buffer Language Guide (proto3)</a>,
the <a href=https://googleapis.dev/python/protobuf/latest/>Python API Reference</a>, the
<a href=/reference/python/python-generated>Python Generated Code Guide</a>,
and the
<a href=/programming-guides/encoding>Encoding Reference</a>.</p><h2 id=problem-domain>The Problem Domain</h2><p>The example we&rsquo;re going to use is a very simple &ldquo;address book&rdquo; application that
can read and write people&rsquo;s contact details to and from a file. Each person in
the address book has a name, an ID, an email address, and a contact phone
number.</p><p>How do you serialize and retrieve structured data like this? There are a few
ways to solve this problem:</p><ul><li>Use Python pickling. This is the default approach since it&rsquo;s built into the
language, but it doesn&rsquo;t deal well with schema evolution, and also doesn&rsquo;t
work very well if you need to share data with applications written in C++ or
Java.</li><li>You can invent an ad-hoc way to encode the data items into a single
string &ndash; such as encoding 4 ints as &ldquo;12:3:-23:67&rdquo;. This is a simple and
flexible approach, although it does require writing one-off encoding and
parsing code, and the parsing imposes a small run-time cost. This works best
for encoding very simple data.</li><li>Serialize the data to XML. This approach can be very attractive since XML is
(sort of) human readable and there are binding libraries for lots of
languages. This can be a good choice if you want to share data with other
applications/projects. However, XML is notoriously space intensive, and
encoding/decoding it can impose a huge performance penalty on applications.
Also, navigating an XML DOM tree is considerably more complicated than
navigating simple fields in a class normally would be.</li></ul><p>Instead of these options, you can use protocol buffers. Protocol buffers are the
flexible, efficient, automated solution to solve exactly this problem. With
protocol buffers, you write a <code>.proto</code> description of the data structure you
wish to store. From that, the protocol buffer compiler creates a class that
implements automatic encoding and parsing of the protocol buffer data with an
efficient binary format. The generated class provides getters and setters for
the fields that make up a protocol buffer and takes care of the details of
reading and writing the protocol buffer as a unit. Importantly, the protocol
buffer format supports the idea of extending the format over time in such a way
that the code can still read data encoded with the old format.</p><h2 id=example-code>Where to Find the Example Code</h2><p>The example code is included in the source code package, under the &ldquo;examples&rdquo;
directory. <a href=/downloads>Download it here.</a></p><h2 id=protocol-format>Defining Your Protocol Format</h2><p>To create your address book application, you&rsquo;ll need to start with a <code>.proto</code>
file. The definitions in a <code>.proto</code> file are simple: you add a <em>message</em> for
each data structure you want to serialize, then specify a name and a type for
each field in the message. Here is the <code>.proto</code> file that defines your messages,
<code>addressbook.proto</code>.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-proto data-lang=proto><span style=display:flex><span><span style=color:#000>syntax</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;proto2&#34;</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>package</span> <span style=color:#000>tutorial</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>Person</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>int32</span> <span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>3</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>enum</span> <span style=color:#000>PhoneType</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>MOBILE</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>HOME</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#000>WORK</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#204a87;font-weight:700>string</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>    <span style=color:#204a87;font-weight:700>optional</span> <span style=color:#000>PhoneType</span> <span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>2</span> <span style=color:#000;font-weight:700>[</span><span style=color:#204a87;font-weight:700>default</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>HOME</span><span style=color:#000;font-weight:700>];</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>PhoneNumber</span> <span style=color:#000>phones</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>4</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#204a87;font-weight:700>message</span> <span style=color:#000>AddressBook</span> <span style=color:#000;font-weight:700>{</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span>  <span style=color:#204a87;font-weight:700>repeated</span> <span style=color:#000>Person</span> <span style=color:#000>people</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>;</span><span style=color:#a40000>
</span></span></span><span style=display:flex><span><span style=color:#a40000></span><span style=color:#000;font-weight:700>}</span><span style=color:#a40000>
</span></span></span></code></pre></div><p>As you can see, the syntax is similar to C++ or Java. Let&rsquo;s go through each part
of the file and see what it does.</p><p>The <code>.proto</code> file starts with a package declaration, which helps to prevent
naming conflicts between different projects. In Python, packages are normally
determined by directory structure, so the <code>package</code> you define in your <code>.proto</code>
file will have no effect on the generated code. However, you should still
declare one to avoid name collisions in the Protocol Buffers name space as well
as in non-Python languages.</p><p>Next, you have your message definitions. A message is just an aggregate
containing a set of typed fields. Many standard simple data types are available
as field types, including <code>bool</code>, <code>int32</code>, <code>float</code>, <code>double</code>, and <code>string</code>. You
can also add further structure to your messages by using other message types as
field types &ndash; in the above example the <code>Person</code> message contains <code>PhoneNumber</code>
messages, while the <code>AddressBook</code> message contains <code>Person</code> messages. You can
even define message types nested inside other messages &ndash; as you can see, the
<code>PhoneNumber</code> type is defined inside <code>Person</code>. You can also define <code>enum</code> types
if you want one of your fields to have one of a predefined list of values &ndash;
here you want to specify that a phone number can be one of the following phone
types: <code>MOBILE</code>, <code>HOME</code>, or <code>WORK</code>.</p><p>The " = 1", " = 2" markers on each element identify the unique &ldquo;tag&rdquo; that field
uses in the binary encoding. Tag numbers 1-15 require one less byte to encode
than higher numbers, so as an optimization you can decide to use those tags for
the commonly used or repeated elements, leaving tags 16 and higher for
less-commonly used optional elements. Each element in a repeated field requires
re-encoding the tag number, so repeated fields are particularly good candidates
for this optimization.</p><p>Each field must be annotated with one of the following modifiers:</p><ul><li><code>optional</code>: the field may or may not be set. If an optional field value
isn&rsquo;t set, a default value is used. For simple types, you can specify your
own default value, as we&rsquo;ve done for the phone number <code>type</code> in the example.
Otherwise, a system default is used: zero for numeric types, the empty
string for strings, false for bools. For embedded messages, the default
value is always the &ldquo;default instance&rdquo; or &ldquo;prototype&rdquo; of the message, which
has none of its fields set. Calling the accessor to get the value of an
optional (or required) field which has not been explicitly set always
returns that field&rsquo;s default value.</li><li><code>repeated</code>: the field may be repeated any number of times (including zero).
The order of the repeated values will be preserved in the protocol buffer.
Think of repeated fields as dynamically sized arrays.</li><li><code>required</code>: a value for the field must be provided, otherwise the message
will be considered &ldquo;uninitialized&rdquo;. Serializing an uninitialized message
will raise an exception. Parsing an uninitialized message will fail. Other
than this, a required field behaves exactly like an optional field.</li></ul><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Required Is Forever</strong>
You should be very careful about marking fields as <code>required</code>. If at some point
you wish to stop writing or sending a required field, it will be problematic to
change the field to an optional field &ndash; old readers will consider messages
without this field to be incomplete and may reject or drop them unintentionally.
You should consider writing application-specific custom validation routines for
your buffers instead. Within Google, <code>required</code> fields are strongly disfavored;
most messages defined in proto2 syntax use <code>optional</code> and <code>repeated</code> only.
(Proto3 does not support <code>required</code> fields at all.)</div><p>You&rsquo;ll find a complete guide to writing <code>.proto</code> files &ndash; including all the
possible field types &ndash; in the
<a href=/programming-guides/proto>Protocol Buffer Language Guide</a>.
Don&rsquo;t go looking for facilities similar to class inheritance, though &ndash; protocol
buffers don&rsquo;t do that.</p><h2 id=compiling-protocol-buffers>Compiling Your Protocol Buffers</h2><p>Now that you have a <code>.proto</code>, the next thing you need to do is generate the
classes you&rsquo;ll need to read and write <code>AddressBook</code> (and hence <code>Person</code> and
<code>PhoneNumber</code>) messages. To do this, you need to run the protocol buffer
compiler <code>protoc</code> on your <code>.proto</code>:</p><ol><li><p>If you haven&rsquo;t installed the compiler,
<a href=/downloads>download the package</a> and follow the
instructions in the README.</p></li><li><p>Now run the compiler, specifying the source directory (where your
application&rsquo;s source code lives &ndash; the current directory is used if you
don&rsquo;t provide a value), the destination directory (where you want the
generated code to go; often the same as <code>$SRC_DIR</code>), and the path to your
<code>.proto</code>. In this case, you&mldr;:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>protoc -I<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$SRC_DIR</span> --python_out<span style=color:#ce5c00;font-weight:700>=</span><span style=color:#000>$DST_DIR</span> <span style=color:#000>$SRC_DIR</span>/addressbook.proto
</span></span></code></pre></div><p>Because you want Python classes, you use the <code>--python_out</code> option &ndash;
similar options are provided for other supported languages.</p></li></ol><p>This generates <code>addressbook_pb2.py</code> in your specified destination directory.</p><h2 id=protobuf-api>The Protocol Buffer API</h2><p>Unlike when you generate Java and C++ protocol buffer code, the Python protocol
buffer compiler doesn&rsquo;t generate your data access code for you directly. Instead
(as you&rsquo;ll see if you look at <code>addressbook_pb2.py</code>) it generates special
descriptors for all your messages, enums, and fields, and some mysteriously
empty classes, one for each message type:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>Person</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Message</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>  <span style=color:#000>__metaclass__</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>reflection</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GeneratedProtocolMessageType</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>PhoneNumber</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Message</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>    <span style=color:#000>__metaclass__</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>reflection</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GeneratedProtocolMessageType</span>
</span></span><span style=display:flex><span>    <span style=color:#000>DESCRIPTOR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>_PERSON_PHONENUMBER</span>
</span></span><span style=display:flex><span>  <span style=color:#000>DESCRIPTOR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>_PERSON</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>class</span> <span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>message</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Message</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>  <span style=color:#000>__metaclass__</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>reflection</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>GeneratedProtocolMessageType</span>
</span></span><span style=display:flex><span>  <span style=color:#000>DESCRIPTOR</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>_ADDRESSBOOK</span>
</span></span></code></pre></div><p>The important line in each class is <code>__metaclass__ = reflection.GeneratedProtocolMessageType</code>. While the details of how Python
metaclasses work is beyond the scope of this tutorial, you can think of them as
like a template for creating classes. At load time, the
<code>GeneratedProtocolMessageType</code> metaclass uses the specified descriptors to
create all the Python methods you need to work with each message type and adds
them to the relevant classes. You can then use the fully-populated classes in
your code.</p><p>The end effect of all this is that you can use the <code>Person</code> class as if it
defined each field of the <code>Message</code> base class as a regular field. For example,
you could write:</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>addressbook_pb2</span>
</span></span><span style=display:flex><span><span style=color:#000>person</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1234</span>
</span></span><span style=display:flex><span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;John Doe&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;jdoe@example.com&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>phone</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#000>phone</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;555-4321&#34;</span>
</span></span><span style=display:flex><span><span style=color:#000>phone</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HOME</span>
</span></span></code></pre></div><p>Note that these assignments are not just adding arbitrary new fields to a
generic Python object. If you were to try to assign a field that isn&rsquo;t defined
in the <code>.proto</code> file, an <code>AttributeError</code> would be raised. If you assign a field
to a value of the wrong type, a <code>TypeError</code> will be raised. Also, reading the
value of a field before it has been set returns the default value.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>no_such_field</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#0000cf;font-weight:700>1</span>  <span style=color:#8f5902;font-style:italic># raises AttributeError</span>
</span></span><span style=display:flex><span><span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#4e9a06>&#34;1234&#34;</span>        <span style=color:#8f5902;font-style:italic># raises TypeError</span>
</span></span></code></pre></div><p>For more information on exactly what members the protocol compiler generates for
any particular field definition, see the
<a href=/reference/python/python-generated>Python generated code reference</a>.</p><h3 id=enums>Enums</h3><p>Enums are expanded by the metaclass into a set of symbolic constants with
integer values. So, for example, the constant
<code>addressbook_pb2.Person.PhoneType.WORK</code> has the value 2.</p><h3 id=standard-message-methods>Standard Message Methods</h3><p>Each message class also contains a number of other methods that let you check or
manipulate the entire message, including:</p><ul><li><code>IsInitialized()</code>: checks if all the required fields have been set.</li><li><code>__str__()</code>: returns a human-readable representation of the message,
particularly useful for debugging. (Usually invoked as <code>str(message)</code> or
<code>print message</code>.)</li><li><code>CopyFrom(other_msg)</code>: overwrites the message with the given message&rsquo;s
values.</li><li><code>Clear()</code>: clears all the elements back to the empty state.</li></ul><p>These methods implement the <code>Message</code> interface. For more information, see the
<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message>complete API documentation for <code>Message</code></a>.</p><h3 id=parsing-serialization>Parsing and Serialization</h3><p>Finally, each protocol buffer class has methods for writing and reading messages
of your chosen type using the protocol buffer
<a href=/programming-guides/encoding>binary format</a>. These
include:</p><ul><li><code>SerializeToString()</code>: serializes the message and returns it as a string.
Note that the bytes are binary, not text; we only use the <code>str</code> type as a
convenient container.</li><li><code>ParseFromString(data)</code>: parses a message from the given string.</li></ul><p>These are just a couple of the options provided for parsing and serialization.
Again, see the
<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>Message</code> API reference</a>
for a complete list.</p><div class="alert alert-warning" role=alert><h4 class=alert-heading>Important</h4><strong>Protocol Buffers and Object Oriented Design</strong>
Protocol buffer classes are basically data holders (like structs in C) that
don&rsquo;t provide additional functionality; they don&rsquo;t make good first class
citizens in an object model. If you want to add richer behavior to a generated
class, the best way to do this is to wrap the generated protocol buffer class in
an application-specific class. Wrapping protocol buffers is also a good idea if
you don&rsquo;t have control over the design of the <code>.proto</code> file (if, say, you&rsquo;re
reusing one from another project). In that case, you can use the wrapper class
to craft an interface better suited to the unique environment of your
application: hiding some data and methods, exposing convenience functions, etc.
<strong>You should never add behavior to the generated classes by inheriting from
them</strong>. This will break internal mechanisms and is not good object-oriented
practice anyway.</div><h2 id=writing-a-message>Writing a Message</h2><p>Now let&rsquo;s try using your protocol buffer classes. The first thing you want your
address book application to be able to do is write personal details to your
address book file. To do this, you need to create and populate instances of your
protocol buffer classes and then write them to an output stream.</p><p>Here is a program which reads an <code>AddressBook</code> from a file, adds one new
<code>Person</code> to it based on user input, and writes the new <code>AddressBook</code> back out to
the file again. The parts which directly call or reference code generated by the
protocol compiler are highlighted.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#! /usr/bin/python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>addressbook_pb2</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>sys</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># This function fills in a Person message based on user input.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>PromptForAddress</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>person</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>  <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>id</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>int</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>raw_input</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter person ID number: &#34;</span><span style=color:#000;font-weight:700>))</span>
</span></span><span style=display:flex><span>  <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>raw_input</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter name: &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>raw_input</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter email address (blank for none): &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>email</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>email</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>while</span> <span style=color:#204a87;font-weight:700>True</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>raw_input</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Enter a phone number (or leave blank to finish): &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#000>phone_number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>    <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>number</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>number</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>raw_input</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#34;Is this a mobile, home, or work phone? &#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#204a87>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;mobile&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>MOBILE</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#204a87>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;home&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HOME</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#204a87>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#4e9a06>&#34;work&#34;</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>      <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>WORK</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>else</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;Unknown phone type; leaving as default value.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Main procedure:  Reads the entire address book from a file,</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   adds one person based on user input, then writes it back out to the same</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   file.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;Usage:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#34;ADDRESS_BOOK_FILE&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>address_book</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Read the existing address book.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>try</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#000>f</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#34;rb&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>  <span style=color:#000>address_book</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>  <span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>except</span> <span style=color:#c00;font-weight:700>IOError</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span> <span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>]</span> <span style=color:#ce5c00;font-weight:700>+</span> <span style=color:#4e9a06>&#34;: Could not open file.  Creating a new one.&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Add an address.</span>
</span></span><span style=display:flex><span><span style=color:#000>PromptForAddress</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>people</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>add</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Write the new address book back to disk.</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#34;wb&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>write</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>SerializeToString</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>()</span>
</span></span></code></pre></div><h2 id=reading-a-message>Reading a Message</h2><p>Of course, an address book wouldn&rsquo;t be much use if you couldn&rsquo;t get any
information out of it! This example reads the file created by the above example
and prints all the information in it.</p><div class=highlight><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#! /usr/bin/python</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>addressbook_pb2</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>import</span> <span style=color:#000>sys</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Iterates though all people in the AddressBook and prints info about them.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>def</span> <span style=color:#000>ListPeople</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>person</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>address_book</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>people</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;Person ID:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>id</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;  Name:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>name</span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HasField</span><span style=color:#000;font-weight:700>(</span><span style=color:#4e9a06>&#39;email&#39;</span><span style=color:#000;font-weight:700>):</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;  E-mail address:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>email</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#204a87;font-weight:700>for</span> <span style=color:#000>phone_number</span> <span style=color:#204a87;font-weight:700>in</span> <span style=color:#000>person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>phones</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>if</span> <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>MOBILE</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;  Mobile phone #: &#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>HOME</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;  Home phone #: &#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87;font-weight:700>elif</span> <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>type</span> <span style=color:#ce5c00;font-weight:700>==</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>Person</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>PhoneType</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>WORK</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>        <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;  Work phone #: &#34;</span><span style=color:#000;font-weight:700>,</span>
</span></span><span style=display:flex><span>      <span style=color:#204a87>print</span> <span style=color:#000>phone_number</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>number</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Main procedure:  Reads the entire address book from a file and prints all</span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic>#   the information inside.</span>
</span></span><span style=display:flex><span><span style=color:#204a87;font-weight:700>if</span> <span style=color:#204a87>len</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>)</span> <span style=color:#ce5c00;font-weight:700>!=</span> <span style=color:#0000cf;font-weight:700>2</span><span style=color:#000;font-weight:700>:</span>
</span></span><span style=display:flex><span>  <span style=color:#204a87>print</span> <span style=color:#4e9a06>&#34;Usage:&#34;</span><span style=color:#000;font-weight:700>,</span> <span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>0</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#34;ADDRESS_BOOK_FILE&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>exit</span><span style=color:#000;font-weight:700>(</span><span style=color:#ce5c00;font-weight:700>-</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>address_book</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#000>addressbook_pb2</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>AddressBook</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8f5902;font-style:italic># Read the existing address book.</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span> <span style=color:#ce5c00;font-weight:700>=</span> <span style=color:#204a87>open</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>sys</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>argv</span><span style=color:#000;font-weight:700>[</span><span style=color:#0000cf;font-weight:700>1</span><span style=color:#000;font-weight:700>],</span> <span style=color:#4e9a06>&#34;rb&#34;</span><span style=color:#000;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#000>address_book</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>ParseFromString</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>read</span><span style=color:#000;font-weight:700>())</span>
</span></span><span style=display:flex><span><span style=color:#000>f</span><span style=color:#ce5c00;font-weight:700>.</span><span style=color:#000>close</span><span style=color:#000;font-weight:700>()</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#000>ListPeople</span><span style=color:#000;font-weight:700>(</span><span style=color:#000>address_book</span><span style=color:#000;font-weight:700>)</span>
</span></span></code></pre></div><h2 id=extending-a-protobuf>Extending a Protocol Buffer</h2><p>Sooner or later after you release the code that uses your protocol buffer, you
will undoubtedly want to &ldquo;improve&rdquo; the protocol buffer&rsquo;s definition. If you want
your new buffers to be backwards-compatible, and your old buffers to be
forward-compatible &ndash; and you almost certainly do want this &ndash; then there are
some rules you need to follow. In the new version of the protocol buffer:</p><ul><li>you <em>must not</em> change the tag numbers of any existing fields.</li><li>you <em>must not</em> add or delete any required fields.</li><li>you <em>may</em> delete optional or repeated fields.</li><li>you <em>may</em> add new optional or repeated fields but you must use fresh tag
numbers (that is, tag numbers that were never used in this protocol buffer,
not even by deleted fields).</li></ul><p>(There are
<a href=/programming-guides/proto#updating>some exceptions</a> to
these rules, but they are rarely used.)</p><p>If you follow these rules, old code will happily read new messages and simply
ignore any new fields. To the old code, optional fields that were deleted will
simply have their default value, and deleted repeated fields will be empty. New
code will also transparently read old messages. However, keep in mind that new
optional fields will not be present in old messages, so you will need to either
check explicitly whether they&rsquo;re set with <code>has_</code>, or provide a reasonable
default value in your <code>.proto</code> file with <code>[default = value]</code> after the tag
number. If the default value is not specified for an optional element, a
type-specific default value is used instead: for strings, the default value is
the empty string. For booleans, the default value is false. For numeric types,
the default value is zero. Note also that if you added a new repeated field,
your new code will not be able to tell whether it was left empty (by new code)
or never set at all (by old code) since there is no <code>has_</code> flag for it.</p><h2 id=advanced-usage>Advanced Usage</h2><p>Protocol buffers have uses that go beyond simple accessors and serialization. Be
sure to explore the
<a href=https://googleapis.dev/python/protobuf/latest/>Python API reference</a> to see
what else you can do with them.</p><p>One key feature provided by protocol message classes is <em>reflection</em>. You can
iterate over the fields of a message and manipulate their values without writing
your code against any specific message type. One very useful way to use
reflection is for converting protocol messages to and from other encodings, such
as XML or JSON. A more advanced use of reflection might be to find differences
between two messages of the same type, or to develop a sort of &ldquo;regular
expressions for protocol messages&rdquo; in which you can write expressions that match
certain message contents. If you use your imagination, it&rsquo;s possible to apply
Protocol Buffers to a much wider range of problems than you might initially
expect!</p><p>Reflection is provided as part of the
<a href=https://googleapis.dev/python/protobuf/latest/google/protobuf/message.html#google.protobuf.message.Message><code>Message</code> interface</a>.</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Stack Overflow" aria-label="Stack Overflow"><a class=text-white target=_blank rel=noopener href=https://stackoverflow.com/questions/tagged/protocol-buffers aria-label="Stack Overflow"><i class="fab fa-stack-overflow"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=40px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#fff data-fg=#000 data-position=bottom data-padding=16px data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/protocolbuffers/protobuf aria-label=GitHub><i class="fab fa-github"></i></a></li><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title="Developer mailing list" aria-label="Developer mailing list"><a class=text-white target=_blank rel=noopener href=https://groups.google.com/g/protobuf aria-label="Developer mailing list"><i class="fa fa-envelope"></i></a></li></ul><script type=text/javascript id=cookiebanner src=https://cdn.jsdelivr.net/gh/dobarkod/cookie-banner@1.2.2/dist/cookiebanner.min.js data-height=40px data-message="Protobuf.dev uses cookies from Google to deliver and enhance the quality of its services and to analyze traffic." data-bg=#fff data-fg=#000 data-position=bottom data-padding=16px data-close-text="OK, got it" data-font-size=18px data-moreinfo=https://policies.google.com/technologies/cookies></script></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2022 Google LLC All Rights Reserved</small>
<small class=ml-1><a href=https://policies.google.com/privacy target=_blank rel=noopener>Privacy Policy</a></small>
<span class=text-white>Hosted by GitHub Pages.</span> <a href=https://docs.github.com/en/site-policy/privacy-policies/github-privacy-statement target=_blank>GitHub Privacy Statement</a></div></div></div></footer></div><script src=/js/main.min.48a7d138dd257f31c8ab8ac8a2922a6911189eae9f353439163ad3316421ea99.js integrity="sha256-SKfRON0lfzHIq4rIopIqaREYnq6fNTQ5FjrTMWQh6pk=" crossorigin=anonymous></script>
<script src=/js/tabpane-persist.js></script></body></html>